<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>文件预览</title>
    <style type="text/css">
    </style>
    <script src="static/scripts/jquery.min.js"></script>
    <script src="static/pdfjs/build/pdf.js"></script>
    <script src="static/pdfjs/build/pdf.worker.js"></script>
    <script type="text/javascript">
        var var_win_height = $(window).height();

        $(document).ready(function () {
            resetPlayerSize(); 
            viewDoc();
        });

        $(window).resize(function () {
            resetPlayerSize();
        });

        function resetPlayerSize() {
            var_win_height = $(window).height();
            $(".tmPlayer").css({ "height": var_win_height + "px" });
        } 
    </script>
</head>

<body style="margin: 0;overflow: hidden"> 
    <div id="tmPlayer" class="tmPlayer" style="height: 557px; width: 100%; height: 100%"></div>

    <script type="text/javascript">
	    
    	function viewDoc()
	   	{
	    	var docId = getQueryString("doc");
		    console.log("viewDoc() docId:"+docId);
		  	
		  	//Convert doc to PDF and return the link, then show the pdf 
		    $.ajax({
		        url : "/DocSystem/Doc/Doc2PDF.do",
		        type : "post",
		        dataType : "json",
		        data : {
		            id : docId,
		        },
		        success : function (ret) {
		            if( "ok" == ret.status ){
		                var fileLink = ret.data.url;
		                console.log("fileLink" + fileLink);
		                showPDF(fileLink);	//show Doc at another page
		            }
		            else
		            {
		            	showErrorMessage("文件预览失败：" + ret.msgInfo);              	
		            }
		        },
		        error : function () {
		            showErrorMessage("文件预览失败：服务器异常");
		        }
		    });
	   	}   
	    
	    function showPDF(url)
	   	{
	        $('.tmPlayer').html('<iframe frameBorder="0" scrolling="no" src="static/pdfjs/web/viewer.html?file=' + url +
	            '" style="width:100%; height:100%;"></iframe>');
	   	}
	    
	    // 从 url 中获取参数
	    function getQueryString(name) {
	        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
	        var r = window.location.search.substr(1).match(reg);
	        if (r != null) {
	            return unescape(r[2]);
	        }
	        return null;
	    }
    </script>
</body>
</html>