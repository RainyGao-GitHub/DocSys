<!-- Share Modal -->
<div id="reposBasicSetting">
        <div class="form-group">
        	<div style="margin-top:10px">
            	<label>仓库名字</label>
            	<input class="form-control" type="text" id="repos-name" value="" style="width: 100%"></input>
            </div>
            
            <div style="margin-top:10px">
            	<label>仓库简介</label>
            	<textarea class="form-control" id="repos-info" style="width: 100%"></textarea>
            </div>
            
            <div style="margin-top:10px">
            	<label>仓库类型</label>
            	<select class="form-control" id="repos-type" onchange="doSelectFS();" disabled="disabled" style="width: 100%">   
            		<option value="1" selected="selected">文件管理系统</option>   
            		<option value="5">文件服务器前置</option>
            	</select>
            </div>

			<div id="remoteServerDiv" style="margin-top:20px; display:none">
                <label style="margin-top:10px">文件服务器</label>
				<select class="form-control" id="remoteServerProtocol" onchange="doSelectremoteServerProtocol();" style="width:100%">   
		            <option value="ftp">FTP</option>   
		            <option value="sftp">SFTP</option>   
		            <option value="smb">SMB</option>  
		            <option value="svn">SVN</option>  
		            <option value="git">GIT</option>  
		        </select>			
				<input class="form-control" type="text" id="remoteServer"  placeholder="ftp://192.168.0.1:22;userName=test;pwd=123456;"  value="" style="width: 100%"/>
			</div>
			
            <div id="reposStorageConfig" style="margin-top:20px">
            	<label>仓库位置</label>
				<input class="form-control" type="text" id="repos-path"  value="" style="width: 100%"></input>
               	
               	<label style="margin-top:10px">文件存储位置
               		<span style="margin-left:20px">
						<input type="checkbox" id="reposStorageRealDocPathEnable" value="0" onclick="doSelectReposStorageRealDocPathEnable()">自定义
					</span> 
               	</label>
               	<div id="reposStorageRealDocPathConfig" style="display:none">
					<input class="form-control" type="text" id="repos-realDocPath"  placeholder="如使用默认位置，请留空！"  value="" style="width: 100%"/>
				</div>
			</div>
			
			<div id="remoteStorageDiv" style="margin-top:20px">
                <label style="margin-top:10px">远程存储
                	<span style="margin-left:5px">
	            		<input type="checkbox" id="remoteStorageConfigEnable" value="0" onclick="doSelectRemoteStorageConfigEnable()">
	            	</span>
                </label>
                
				<div id="remoteStorageConfigDiv" style="display:none">
					<select class="form-control" id="remoteStorageProtocol" onchange="doSelectRemoteStorageProtocol();" style="width:100%">   
			        	<option value="">无</option>
			            <option value="ftp">FTP</option>   
			            <option value="sftp">SFTP</option>   
			            <option value="smb">SMB</option>  
			            <option value="svn">SVN</option>  
			            <option value="git">GIT</option>  
			        </select>			
					<div id="remoteStorageProtocolConfig"  style="margin-top:10px; display:none">
						<input class="form-control" type="text" id="remoteStorage"  placeholder="ftp://192.168.0.1:22;userName=test;pwd=123456;"  value="" style="width: 100%"/>
			        	<label style="margin-left:1px">自动拉取 <span style="margin-left:3px"><input type="checkbox" id="remoteStorage-autoPull" value="0"></span></label>
			            <label style="margin-left:10px">强制拉取 <span style="margin-left:3px"><input type="checkbox" id="remoteStorage-autoPullForce" value="0"></span></label>
			            <label style="margin-left:15px">自动推送 <span style="margin-left:3px"><input type="checkbox" id="remoteStorage-autoPush" value="0"></span></label>
			            <label style="margin-left:10px">强制推送 <span style="margin-left:3px"><input type="checkbox" id="remoteStorage-autoPushForce" value="0"></span></label>
			        </div>
				</div>
			</div>

            <div id="verCtrlDiv"  style="margin-top:20px;">
	        	<div id="verCtrlEnablelDiv" style="margin-top:20px">
		            <label>版本管理 
		            	<span style="margin-left:5px">
		            		<input type="checkbox" id="verCtrlEnable" value="0" onclick="doSelectVerCtrlEnable()">
		            	</span>
		            </label>
		            <span id="showVerCtrlConfig" value="0" style="margin-left:20px;display:none" onclick="doSelectShowVerCtrlConfig()">显示高级选项</span>
				</div>

	            <div id="verCtrlConfigDiv" style="display:none">
		            <label style="margin-left:20px">版本仓库类型 <span id="verCtrl-isRemoteSetting" style="margin-left:20px"><input type="checkbox" id="verCtrl-isRemote" value="0" onclick="doSelectVerCtrl()">自定义</span></label>
		            <select class="form-control" id="repos-verCtrl" onchange="doSelectVerCtrl();" style="margin-left:20px; width: 100%">   
		            	<option value="0">无</option>   
		            	<option value="1">SVN</option>   
		            	<option value="2">GIT</option> 
		            </select>
		            <div id="verCtrl-verReposSetting" style="margin-left:20px">
			            <div id="verCtrl-localVerRepos">
				            <label>版本仓库所在目录</label>
				            <input class="form-control" type="text" id="verCtrl-localSvnPath"  placeholder="如使用系统默认位置，请留空！"  value="" style="width: 100%"/>
			            </div>
			            <div id="verCtrl-remoteVerRepos">
				            <label>版本仓库链接</label>
				            <input class="form-control" type="text" id="verCtrl-svnPath"  placeholder="请填写版本仓库链接！" value="" style="width: 100%"></input>
				            <label>用户名</label>
				            <input class="form-control" type="text" id="verCtrl-svnUser" value="" style="width: 100%"></input>
				            <label>密码</label>
				            <input class="form-control" type="password" id="verCtrl-svnPwd" value="" style="width: 100%"></input>
						</div>
					</div>
				</div>
			</div>
			
			<div id="virtualDocVerCtrlConfigDiv" style="margin-left:20px; display:none">
				<label>备注版本管理<span id="verCtrl1-isRemoteSetting" style="margin-left:20px"><input type="checkbox" id="verCtrl1-isRemote" value="0" onclick="doSelectVerCtrl1()">自定义</span></label>
	            <select class="form-control" id="repos-verCtrl1" onchange="doSelectVerCtrl1()" style="width: 100%">   
	            	<option value="0">无</option>   
	            	<option value="1">SVN</option>   
	            	<option value="2">GIT</option>  
	            </select>
	            <div id="verCtrl1-verReposSetting">
		            <div id="verCtrl1-localVerRepos">
			            <label>版本仓库所在目录</label>
			            <input class="form-control" type="text" id="verCtrl1-localSvnPath"  placeholder="如使用系统默认位置，请留空！"  value="" style="width: 100%"/>
		            </div>
					<div id="verCtrl1-remoteVerRepos">
			            <label>版本仓库链接</label>
			            <input class="form-control" type="text" id="verCtrl1-svnPath"  placeholder="请填写版本仓库链接！" value="" style="width: 100%"></input>
			            <label>用户名</label>
			            <input class="form-control" type="text" id="verCtrl1-svnUser" value="" style="width: 100%"></input>
			            <label>密码</label>
			            <input class="form-control" type="password" id="verCtrl1-svnPwd" value="" style="width: 100%"></input>              
					</div>
				</div>
			</div>
			
			<div id="textSearchEnablelDiv" style="margin-top:20px">
	            <label>全文搜索 <span style="margin-left:5px"><input type="checkbox" id="isTextSearchEnabled" value="0"></span></label>
			</div>
			
			<div id="encryptEnablelDiv" style="margin-top:20px">
	            <label>文件加密 <span style="margin-left:5px"><input type="checkbox" id="isEncryptEnabled" value="0" onclick="doSetEncryptConfirm()"></span></label>
			</div>
			
			<div id="autoBackupEnablelDiv" style="margin-top:20px">
	            <label>自动备份 
	            	<span style="margin-left:5px">
	            		<input type="checkbox" id="autoBackupEnable" value="0" onclick="doSelectAutoBackupConfigEanble()">
	            	</span>
	            </label>
			</div>
			
			<div id="autoBackupConfigDiv" style="margin-left:20px;margin-top:10px;display:none">
	            <label>本地备份
	            	<span style="margin-left:5px">
	            		<input type="checkbox" id="localBackupEnable" value="0" onclick="doSelectLocalBackupEnable()">
	            	</span>
	            </label>
	            <div id="localBackupConfig" style="display:none">
				    <input class="form-control" type="text" id="localBackupRootPath"  placeholder="请填写备份存储路径！" value="" style="width: 100%"/>
    				<label style="margin-top:5px">备份时间</label>
		        	<select class="form-control" id="localBackupTime" style="width:100%">   
				        <option value="0">0:00</option>   
				        <option value="60">1:00</option>   
				        <option value="120">2:00</option>   
				        <option value="180">3:00</option>  
				        <option value="240">4:00</option>  
				        <option value="300">5:00</option>  
				        <option value="360">6:00</option>  
				        <option value="420">7:00</option>  
				        <option value="480">8:00</option>  
				        <option value="540">9:00</option>  
				        <option value="600">10:00</option>
				        <option value="660">11:00</option>
				        <option value="720">12:00</option>
				        <option value="780">13:00</option>
				        <option value="840">14:00</option>
				        <option value="900">15:00</option>
				        <option value="960">16:00</option>
				        <option value="1020">17:00</option>
				        <option value="1080">18:00</option>
				        <option value="1140">19:00</option>
				        <option value="1200">20:00</option>
				        <option value="1260">21:00</option>
				        <option value="1320">22:00</option>
				        <option value="1380">23:00</option>
				    </select>
					<label style="margin-top:5px">备份周期</label>
					<div>
						<span><input type="checkbox" id="localBackupWeekDay1" value="0">周一</span>
						<span style="margin-left:20px"><input type="checkbox" id="localBackupWeekDay2" value="0">周二</span>
						<span style="margin-left:20px"><input type="checkbox" id="localBackupWeekDay3" value="0">周三</span>
						<span style="margin-left:20px"><input type="checkbox" id="localBackupWeekDay4" value="0">周四</span>
						<span style="margin-left:20px"><input type="checkbox" id="localBackupWeekDay5" value="0">周五</span>
						<span style="margin-left:20px"><input type="checkbox" id="localBackupWeekDay6" value="0">周六</span>
						<span style="margin-left:20px"><input type="checkbox" id="localBackupWeekDay7" value="0">周日</span>
					</div>				    
		            <label style="margin-top:5px">开启实时备份		            	
		            	<span style="margin-left:5px">
	            			<input type="checkbox" id="localBackup-realTimeBackupEnable" value="0">
	            		</span>
		            </label>		            
	            </div>

				<br>

	            <label style="margin-top:10px">异地备份 
	            	<span style="margin-left:5px;">
	            		<input type="checkbox" id="remoteBackupEnable" value="0" onclick="doSelectRemoteBackupEnable()">
	            	</span>
	            </label>
	            <div id="remoteBackupConfig" style="display:none">
		        	<select class="form-control" id="remoteBackupStorageProtocol" onchange="doSelectRemoteBackupStorageProtocol();" style="width:100%">   
				        <option value="">无</option>
				        <option value="ftp">FTP</option>   
				        <option value="sftp">SFTP</option>   
				        <option value="smb">SMB</option>  
				        <option value="svn">SVN</option>  
				        <option value="git">GIT</option>  
				        <option value="mxsdoc">MXSDOC</option>  
				    </select>
				    <div id="remoteBackupStorageConfig" style="margin-top:10px; display:none">
		           		<input class="form-control" type="text" id="remoteBackupStorage"  placeholder="ftp://192.168.0.1:21;userName=test;pwd=123456"  value="" style="width:100%"/>
	    				<label style="margin-top:5px">备份时间</label>
			        	<select class="form-control" id="remoteBackupTime" style="width:100%">   
					        <option value="0">0:00</option>   
					        <option value="60">1:00</option>   
					        <option value="120">2:00</option>   
					        <option value="180">3:00</option>  
					        <option value="240">4:00</option>  
					        <option value="300">5:00</option>  
					        <option value="360">6:00</option>  
					        <option value="420">7:00</option>  
					        <option value="480">8:00</option>  
					        <option value="540">9:00</option>  
					        <option value="600">10:00</option>
					        <option value="660">11:00</option>
					        <option value="720">12:00</option>
					        <option value="780">13:00</option>
					        <option value="840">14:00</option>
					        <option value="900">15:00</option>
					        <option value="960">16:00</option>
					        <option value="1020">17:00</option>
					        <option value="1080">18:00</option>
					        <option value="1140">19:00</option>
					        <option value="1200">20:00</option>
					        <option value="1260">21:00</option>
					        <option value="1320">22:00</option>
					        <option value="1380">23:00</option>
					    </select>
						<label style="margin-top:5px">备份周期</label>
						<div>
							<span><input type="checkbox" id="remoteBackupWeekDay1" value="0">周一</span>
							<span style="margin-left:20px"><input type="checkbox" id="remoteBackupWeekDay2" value="0">周二</span>
							<span style="margin-left:20px"><input type="checkbox" id="remoteBackupWeekDay3" value="0">周三</span>
							<span style="margin-left:20px"><input type="checkbox" id="remoteBackupWeekDay4" value="0">周四</span>
							<span style="margin-left:20px"><input type="checkbox" id="remoteBackupWeekDay5" value="0">周五</span>
							<span style="margin-left:20px"><input type="checkbox" id="remoteBackupWeekDay6" value="0">周六</span>
							<span style="margin-left:20px"><input type="checkbox" id="remoteBackupWeekDay7" value="0">周日</span>
						</div>

		            	<label style="margin-top:10px">高级选项
		            		<span style="margin-left:5px">
		            			<input type="checkbox" id="remoteBackupFilterEnable" value="0" onclick="doSelectRemoteBackupFilterEnable()">
		            		</span>
		            	</label>
						<div id="remoteBackupFilterConfig" style="margin-top:5px; display:none">
							<div style="height:60px;">
								<span>允许未知文件类型<input type="checkbox" id="isUnkownFileAllowed" value="1" checked style="margin-left:25px"></span>
							</div>    
							<div style="height:60px;">
								<span style="margin-top:5px">允许的文件类型</span>
								<textarea class="form-control" id="allowedFileTypeList" style="position: relative;top:-33px;left:25%; width:75%"></textarea>
							</div>  
							<div style="height:60px;">
								<span style="margin-top:5px">不允许的文件类型</span>
								<textarea class="form-control" id="notAllowedFileTypeList" style="position: relative;top:-33px;left:25%; width:75%"></textarea>
							</div>  
							<div style="height:60px;">
								<span style="margin-top:5px">不允许的文件</span>
								<textarea class="form-control" id="notAllowedFileList" style="position: relative;top:-33px;left:25%; width:75%"></textarea>
							</div>  
							<div style="height:60px;">
								<span style="margin-top:5px">允许的最大文件</span>
								<select class="form-control" id="allowedMaxFile" style="position: relative;top:-33px;left:25%; width:75%">  
							        <option value="10485760">10M</option>   
							        <option value="20971520">20M</option>   
							        <option value="52428800">50M</option>   
							        <option value="104857600">100M</option>  
							        <option value="209715200">200M</option>  
							        <option value="524288000">500M</option>  
							        <option value="1073741824">1G</option>  
							        <option value="2147483648">2G</option>  
							        <option value="4294967296">4G</option>  
							        <option value="0" selected>不限</option>  
							    </select>
							</div>  
						</div>
						<div></div>
	
			            <label style="margin-top:5px">开启实时备份
			            	<span style="margin-left:5px">
		            			<input type="checkbox" id="remoteBackup-realTimeBackupEnable" value="0">
		            		</span>
		            	</label>		      
		            </div>      
	            </div>
	    	</div>
		</div>	
        <a href='javascript:void(0)' onclick="saveReposBasicSetting();" class='mybtn-primary'>保存</a>
</div>

<script type="text/javascript" src="js/remoteStorageCommon.js"></script>
<script type="text/javascript">	
function reposBasicSettingPageInit()
{
	console.log("reposBasicSettingPageInit");
	getReposBasicSetting();
}
        
//页面初始化代码    
$(function(){
	reposBasicSettingPageInit();
});
	
//显示仓库公开访问权限设置
var gReposBasicSetting = [];
function getReposBasicSetting()
{
	console.log("getReposBasicSetting");
	var vid = getQueryString("vid");
    $.ajax({
           url : "/DocSystem/Repos/getRepos.do",
           type : "post",
           dataType : "json",
           data : {
               vid : vid,
           },
           success : function (ret) {
               if( "ok" == ret.status ){
               		gReposBasicSetting = ret.data;
               		console.log("gReposBasicSetting", gReposBasicSetting);
               		showReposBasicSetting(ret.data);
               }else {
					showErrorMessage(ret.msgInfo);
               }
           },
           error : function () {
               showErrorMessage("服务器异常:获取仓库信息失败");
           }
    });
    
	function showReposBasicSetting(reposInfo)
	{
	   	$("#repos-name").val(reposInfo.name);
	   	$("#repos-info").val(reposInfo.info);
	   	$("#repos-path").val(reposInfo.path);
	   	
	   	if(reposInfo.type == 1 || reposInfo.type == 2)
	   	{
	   		$("#repos-type").get(0).selectedIndex=0;	//文件管理系统
	   	}
	   	else
	   	{
	   		$("#repos-type").get(0).selectedIndex=1;	//文件服务器前置
	   	}
	   	
	   	//文件存储路径显示
	   	showReposStorageRealDocPath(reposInfo);
	   	
	   	//文件服务器前置
	   	showRemoteServerConfig(reposInfo);
	   	
	   	//远程存储
	   	showRemoteStorageConfig(reposInfo);
	   	
	   	//版本管理
	   	if(reposInfo.verCtrl == 0)
	   	{
	   		$("#verCtrlEnable").attr("checked",false);
	   		$("#verCtrlConfigDiv").hide();		//隐藏 高级选项
	   		$("#showVerCtrlConfig").hide();	//隐藏 高级选项提示
	   		$("#showVerCtrlConfig").val(0);
	   		$("#showVerCtrlConfig").text("显示高级选项");
	   	}
	   	else
	   	{	
	   		$("#verCtrlEnable").attr("checked","checked");
	   		$("#verCtrlConfigDiv").hide();			//隐藏 高级选项
	   		$("#showVerCtrlConfig").show();		//显示 高级选项提示
	   		$("#showVerCtrlConfig").val(0);
	   		$("#showVerCtrlConfig").text("显示高级选项");						
	   	}
	   	$("#repos-verCtrl option[value='"+reposInfo.verCtrl+"']").attr("selected","selected");
	   	if(reposInfo.isRemote == 0)
	   	{
		   	$("#verCtrl-isRemote").attr("checked",false);
	   	}
	   	else
	   	{
		   	$("#verCtrl-isRemote").attr("checked","checked");
	   	}
	   	$("#verCtrl-localSvnPath").val(reposInfo.localSvnPath);
	   	$("#verCtrl-svnPath").val(reposInfo.svnPath);
	   	$("#verCtrl-svnUser").val(reposInfo.svnUser);
	   	$("#verCtrl-svnPwd").val(reposInfo.svnPwd);
	   	
	   	//备注版本管理
	   	$("#repos-verCtrl1 option[value='"+reposInfo.verCtrl1+"']").attr("selected","selected");
	   	if(reposInfo.isRemote1 == 0)
	   	{
		   	$("#verCtrl1-isRemote").attr("checked",false);	   		
	   	}
	   	else
	   	{
		   	$("#verCtrl1-isRemote").attr("checked","checked");
	   	}
	   	$("#verCtrl1-localSvnPath").val(reposInfo.localSvnPath1);
	   	$("#verCtrl1-svnPath").val(reposInfo.svnPath1);
	   	$("#verCtrl1-svnUser").val(reposInfo.svnUser1);
	   	$("#verCtrl1-svnPwd").val(reposInfo.svnPwd1);
		
	   	//全文搜索
	    showTextSearchConfig(reposInfo);
	   	
	   	//文件加密
	   	if(reposInfo.encryptType == 0)
	   	{
		   	$("#isEncryptEnabled").attr("checked",false);
	   	}
	   	else
	   	{
		   	$("#isEncryptEnabled").attr("checked","checked");
	   	}
	   	
	   	//自动备份
	   	showAutoBackupConfig(reposInfo);
	   	
	   	//初始化显示
	   	doSelectFS();
	}
}

function saveReposBasicSetting()
{
	console.log("saveReposBasicSetting");
	var newReposSetting = [];
	newReposSetting.vid = getQueryString("vid");
	newReposSetting.name = $("#repos-name").val();
	newReposSetting.info = $("#repos-info").val();
	newReposSetting.type =  $("#repos-type").val();	//Real DocSystem
	newReposSetting.path = $("#repos-path").val();
	newReposSetting.realDocPath = $("#repos-realDocPath").val();
	var remoteServer = getRemoteServerConfig();
	newReposSetting.remoteServer = remoteServer;
	var remoteStorage = getRemoteStorageConfig();
	newReposSetting.remoteStorage = remoteStorage;
	var autoBackup = getAutoBackupConfig();
	newReposSetting.autoBackup = autoBackup;
	console.log("newReposSetting.autoBackup:" + autoBackup);

	newReposSetting.verCtrl = $("#repos-verCtrl").val();
	newReposSetting.isRemote =  $("#verCtrl-isRemote").is(':checked')? 1: 0;
	newReposSetting.localSvnPath = $("#verCtrl-localSvnPath").val();
	newReposSetting.svnPath = $("#verCtrl-svnPath").val();
	newReposSetting.svnUser = $("#verCtrl-svnUser").val();
	newReposSetting.svnPwd = $("#verCtrl-svnPwd").val();
	newReposSetting.verCtrl1 = $("#repos-verCtrl1").val();
	newReposSetting.isRemote1 =  $("#verCtrl1-isRemote").is(':checked')? 1: 0;
	newReposSetting.localSvnPath1 = $("#verCtrl1-localSvnPath").val();
	newReposSetting.svnPath1 = $("#verCtrl1-svnPath").val();
	newReposSetting.svnUser1 = $("#verCtrl1-svnUser").val();
	newReposSetting.svnPwd1 = $("#verCtrl1-svnPwd").val();
	
	var textSearch = getTextSearchConfig();
	newReposSetting.textSearch = textSearch;
	console.log("newReposSetting.textSearch:" + textSearch);
	
	newReposSetting.encryptType =  $("#isEncryptEnabled").is(':checked')? 1: 0;
    //default to set VirtualDoc VersionControl as GIT
    if(newReposSetting.verCtrl1 == 0)
    {
    	newReposSetting.verCtrl1 = 2;
    }
    
	console.log(newReposSetting);
	
	if(newReposSetting.isRemote == 0)
	{
		newReposSetting.localSvnPath = newReposSetting.path + "DocSysVerReposes/";
	}
	
	if(newReposSetting.isRemote1 == 0)
	{
		newReposSetting.localSvnPath1 = newReposSetting.path + "DocSysVerReposes/";        		
	}
	
	if(verifyReposSetting(gReposBasicSetting,newReposSetting) == true)
	{	
   		$.ajax({
                url : "/DocSystem/Repos/updateReposInfo.do",
                type : "post",
                dataType : "json",
                data : {
                	reposId : newReposSetting.vid,
                    name : newReposSetting.name,
                    info : newReposSetting.info,
                    type : newReposSetting.type,
                    path : newReposSetting.path,
                    realDocPath : newReposSetting.realDocPath,
                    remoteServer : newReposSetting.remoteServer,
                    remoteStorage : newReposSetting.remoteStorage,
                    verCtrl : newReposSetting.verCtrl,
                    isRemote : newReposSetting.isRemote,
                    localSvnPath : newReposSetting.localSvnPath,
                    svnPath : newReposSetting.svnPath,
                    svnUser : newReposSetting.svnUser,
                    svnPwd : newReposSetting.svnPwd,
                    verCtrl1 : newReposSetting.verCtrl1,
                    isRemote1 : newReposSetting.isRemote1,
                    localSvnPath1 : newReposSetting.localSvnPath1,
                    svnPath1 : newReposSetting.svnPath1,
                    svnUser1 : newReposSetting.svnUser1,
                    svnPwd1 : newReposSetting.svnPwd1,
                    textSearch: newReposSetting.textSearch,
                    encryptType: newReposSetting.encryptType,
                    autoBackup : newReposSetting.autoBackup,                    
                },
                success : function (ret) {
                	if(ret.status == "ok")
                	{
                		console.log("更新仓库设置成功");
                		getReposBasicSetting();     
                		// 普通消息提示条
						bootstrapQ.msg({
						msg : '设置完成！',
						type : 'success',
						time : 2000,
					    });
	                }
                    else
                    {
                    	alert(ret.msgInfo);
                    }
                },
                error : function () {
                    alert('服务器异常: 设置失败');
                }
            });
            return true;
       }
       else
       {
            return false;
       }    
       
       function verifyReposSetting(oldSetting, newSetting)
       {
       		if(oldSetting.name != newSetting.name)
       		{
       			//alert("仓库名字不能修改");
       			return true;
       		}
       		
       		if(oldSetting.type != newSetting.type)
       		{
       			alert("仓库类型不能修改");
       			return false;
       		}
       		
       		if(oldSetting.path != newSetting.path)
       		{
       			return true;
       		}
       		
       		if(oldSetting.realDocPath != newSetting.realDocPath)
       		{
       			return true;
       		}

       		if(oldSetting.remoteServer != newSetting.remoteServer)
       		{
       			return true;
       		}
       		
       		if(oldSetting.remoteStorage != newSetting.remoteStorage)
       		{
       			return true;
       		}
       		
       		if(oldSetting.info != newSetting.info)
       		{
       			return true;
       		}
       		if(oldSetting.verCtrl != newSetting.verCtrl)
       		{
       			return true;
       		}
       		if(oldSetting.isRemote != newSetting.isRemote)
       		{
       			return true;
       		}
       		if(oldSetting.localSvnPath != newSetting.localSvnPath)
       		{
       			return true;
       		}
       		if(oldSetting.svnPath != newSetting.svnPath)
       		{
       			return true;
       		}
       		if(oldSetting.svnUser != newSetting.svnUser)
       		{
       			return true;
       		}
       		if(oldSetting.svnPwd != newSetting.svnPwd)
       		{
       			return true;
       		}
       		if(oldSetting.verCtrl1 != newSetting.verCtrl1)
       		{
       			return true;
       		}
       		if(oldSetting.isRemote1 != newSetting.isRemote1)
       		{
       			return true;
       		}
       		if(oldSetting.localSvnPath1 != newSetting.localSvnPath1)
       		{
       			return true;
       		}
       		if(oldSetting.svnPath1 != newSetting.svnPath1)
       		{
       			return true;
       		}
       		if(oldSetting.svnUser1 != newSetting.svnUser1)
       		{
       			return true;
       		}
       		if(oldSetting.svnPwd1 != newSetting.svnPwd1)
       		{
       			return true;
       		} 
       		if(oldSetting.textSearch != newSetting.textSearch)
       		{
       			return true;
       		}
       		if(oldSetting.encryptType != newSetting.encryptType)
       		{
       			return true;
       		}
       		
       		if(oldSetting.autoBackup != newSetting.autoBackup)
       		{
       			return true;
       		}
       		alert("仓库信息未变化！");
       		return false;
       }  
}

//文件系统类型改变时需要根据文件系统类型，显示或者不显示相关信息
function doSelectFS()
{
	var type = $("#repos-type").val();
	console.log("doSelectFS type:" + type);
	
	if(type == 1 || type == 2)
	{
		$("#remoteServerDiv").hide();
		$("#remoteStorageDiv").show();
		$("#verCtrlDiv").show();
	}
	else
	{
		$("#remoteServerDiv").show();
		$("#remoteStorageDiv").hide();
		$("#verCtrlDiv").hide();
	}
}

/** 文件存储位置设置 **/
function showReposStorageRealDocPath(reposInfo)
{
   	if(reposInfo.realDocPath == null || reposInfo.realDocPath == "")
   	{
		$("#reposStorageRealDocPathEnable").attr("checked",false);
   		$("#reposStorageRealDocPathConfig").hide();
   	}
   	else
   	{
   		$("#reposStorageRealDocPathEnable").attr("checked","checked");
		$("#reposStorageRealDocPathConfig").show();
   		$("#repos-realDocPath").val(reposInfo.realDocPath);
   	}	
}

function doSelectReposStorageRealDocPathEnable()
{
	var reposStorageRealDocPathEnable = $("#reposStorageRealDocPathEnable").is(':checked')? 1: 0;
	console.log("doSelectReposStorageRealDocPathEnable reposStorageRealDocPathEnable:" + reposStorageRealDocPathEnable);
	if(reposStorageRealDocPathEnable == 0)
	{
		$("#reposStorageRealDocPathConfig").hide();
	}
	else
	{	
		$("#reposStorageRealDocPathConfig").show();
	}
}

/** 版本管理设置 **/
function doSelectVerCtrlEnable()
{
	var verCtrlEnable = $("#verCtrlEnable").is(':checked')? 1: 0;
	console.log("doSelectVerCtrlEnable verCtrlEnable:" + verCtrlEnable);
	if(verCtrlEnable == 0)
	{
		$("#repos-verCtrl").get(0).selectedIndex=0;	//关闭verCtrl

		$("#verCtrlConfigDiv").hide();		//隐藏 高级选项
		
		$("#showVerCtrlConfig").hide();	//隐藏 高级选项提示
		$("#showVerCtrlConfig").val(0);
		$("#showVerCtrlConfig").text("显示高级选项");
	}
	else
	{	
		if($("#repos-verCtrl").val() == 0)	//设置版本控制为GIT
		{
			$("#repos-verCtrl").get(0).selectedIndex=2;
		}
		
		$("#verCtrlConfigDiv").hide();			//隐藏 高级选项
		
		$("#showVerCtrlConfig").show();		//显示 高级选项提示
		$("showVerCtrlConfig").val(0);
		$("#showVerCtrlConfig").text("显示高级选项");						
	}
	
	doSelectVerCtrl();
}

function doSelectShowVerCtrlConfig()
{
	var showVerCtrlConfig = $("#showVerCtrlConfig").val();
	console.log("doSelectShowVerCtrlConfig showVerCtrlConfig:" + showVerCtrlConfig);
	if(showVerCtrlConfig == 0)
	{
		$("#showVerCtrlConfig").val(1);
		$("#showVerCtrlConfig").text("隐藏高级选项");
		$("#verCtrlConfigDiv").show();			
	}
	else
	{
		$("#showVerCtrlConfig").val(0);
		$("#showVerCtrlConfig").text("显示高级选项");
		$("#verCtrlConfigDiv").hide();						
	}
}

function doSelectVerCtrl()
{
	console.log("doSelectVerCtrl");
	var verCtrl = $("#repos-verCtrl").val();
	var isRemote = $("#verCtrl-isRemote").is(':checked')? 1: 0;
	
	if(verCtrl != 0) 			//show verRepos info
	{
		if(isRemote == 0)
		{
			$("#verCtrl-localVerRepos").hide();
			$("#verCtrl-remoteVerRepos").hide();
		}
		else
		{
			if(verCtrl == 1)
			{
				$("#verCtrl-localVerRepos").hide();
			}
			else
			{
				$("#verCtrl-localVerRepos").show();
			}
			$("#verCtrl-remoteVerRepos").show();				
		}
		$("#verCtrl-isRemoteSetting").show();							
		$("#verCtrl-verReposSetting").show();				
	}
	else	//hide verRepos info
	{
		$("#verCtrl-isRemoteSetting").hide();
		$("#verCtrl-verReposSetting").hide();				
	}    
}

function doSelectVerCtrl1()
{
	console.log("doSelectVerCtrl1");
	var verCtrl = $("#repos-verCtrl1").val();
	var isRemote = $("#verCtrl1-isRemote").is(':checked')? 1: 0;
	
	if(verCtrl != 0) 			//show verRepos info
	{
		if(isRemote == 0)
		{
			$("#verCtrl1-localVerRepos").hide();
			$("#verCtrl1-remoteVerRepos").hide();
		}
		else
		{
			if(verCtrl == 1)
			{
				$("#verCtrl1-localVerRepos").hide();
			}
			else
			{
				$("#verCtrl1-localVerRepos").show();
			}
			$("#verCtrl1-remoteVerRepos").show();				
		}
		$("#verCtrl1-isRemoteSetting").show();
		$("#verCtrl1-verReposSetting").show();				
	}
	else	//hide verRepos info
	{
		$("#verCtrl1-isRemoteSetting").hide();
		$("#verCtrl1-verReposSetting").hide();				
	}  
}

function doSetEncryptConfirm()
{
	var en = $("#isEncryptEnabled").is(':checked')? 1: 0;
	if(en == 1)
	{
		qiao.bs.confirm({
	        id: 'setEncryptConfirm',
	        msg: '仓库文件将被加密存储，密钥一旦丢失将导致文件无法恢复，是否加密？',
	    },function(){
	    	//确认
	    	$("#isEncryptEnabled").attr("checked","checked");
	    },function(){
			//取消
	    	$("#isEncryptEnabled").attr("checked",false);			
	    });
	}
}

/*** 文件服务器前置 ****/
function showRemoteServerConfig(reposInfo)
{
	if(reposInfo.remoteServerConfig == undefined)
   	{
		$("#remoteServerDiv").hide();
		$("#remoteServerProtocol option[value='']").attr("selected","selected");		
		return;
   	}
	
	var protocol = reposInfo.remoteServerConfig.protocol;
	if(protocol == undefined || protocol == "")
	{
		$("#remoteServerProtocol option[value='']").attr("selected","selected");			
		$("#remoteServerDiv").hide();
		return;
	}
	
	$("#remoteServerDiv").show();			
	$("#remoteServerProtocol option[value='" + protocol + "']").attr("selected","selected");	
	
	var remoteServer = buildRemoteStorageConfigStr(reposInfo.remoteServerConfig);
	$("#remoteServer").val(remoteServer);
}

function doSelectRemoteServerProtocol()
{
	var protocol = $("#remoteServerProtocol").val();
	console.log("doSelectRemoteServerProtocol protocol:" + protocol);
	if(protocol == undefined || protocol == "")
	{
		$("#remoteServerConfig").hide();
		return;
	}
	
	var placehoder = getPlacehoderForRemoteStorageProtocol(protocol);
	$("#remoteServer").attr('placeholder', placehoder);
	$("#remoteServerConfig").show();		
}

function getRemoteServerConfig()
{   
	var protocol = $("#remoteServerProtocol").val();
	console.log("getRemoteServerConfig protocol:" + protocol);
	if(protocol == undefined || protocol == "")
	{
		return "";
	}
	
	var prefix = "";
	switch(protocol)
	{
	case "svn":
		prefix = "svn://";
		break;
	case "git":
		prefix = "git://";
		break;
	case "mxsdoc":
		prefix = "mxsdoc://";
		break;
	}
	
    var remoteServer = $("#remoteServer").val();	//remoteServer
    if(remoteServer != undefined && remoteServer != "")
	{
    	remoteServer = prefix + remoteServer;
	}
    console.log("getRemoteStorageConfig remoteServer:" + remoteServer);
	return remoteServer;
}	

/*** 远程存储 ****/
function showRemoteStorageConfig(reposInfo)
{
	if(reposInfo.remoteStorageConfig == undefined)
   	{
    	$("#remoteStorageConfigDiv").hide();
       	$("#remoteStorageConfigEnable").attr("checked",false);
		
		$("#remoteStorageProtocolConfig").hide();
		$("#remoteStorageProtocol option[value='']").attr("selected","selected");		
		return;
   	}
	
	$("#remoteStorageConfigDiv").show();
   	$("#remoteStorageConfigEnable").attr("checked","checked");
   	
	var protocol = reposInfo.remoteStorageConfig.protocol;
	if(protocol == undefined || protocol == "")
	{
		$("#remoteStorageProtocol option[value='']").attr("selected","selected");			
		$("#remoteStorageProtocolConfig").hide();
		return;
	}
	
	$("#remoteStorageProtocolConfig").show();			
	$("#remoteStorageProtocol option[value='" + protocol + "']").attr("selected","selected");	
	
	var remoteStorage =  buildRemoteStorageConfigStr(reposInfo.remoteStorageConfig);
	$("#remoteStorage").val(remoteStorage);
	
   	if(reposInfo.remoteStorageConfig.autoPull != undefined && reposInfo.remoteStorageConfig.autoPull == 1)
   	{
   		$("#autoPull").attr("checked","checked");
   	}
   	else
   	{
   		$("#autoPull").attr("checked",false);
   	}
   		
   	if(reposInfo.remoteStorageConfig.autoPullForce != undefined && reposInfo.remoteStorageConfig.autoPullForce == 1)
   	{
		$("#autoPullForce").attr("checked","checked");
   	}
   	else
   	{
   		$("#autoPullForce").attr("checked",false);
   	}
   		
   	if(reposInfo.remoteStorageConfig.autoPush != undefined && reposInfo.remoteStorageConfig.autoPush == 1)
   	{
   		$("#autoPush").attr("checked","checked");
   	}
   	else
   	{
		$("#autoPush").attr("checked",false);
   	}
   	
   	if(reposInfo.remoteStorageConfig.autoPushForce != undefined && reposInfo.remoteStorageConfig.autoPushForce == 1)
   	{
   		$("#autoPushForce").attr("checked","checked");
   	}
   	else
   	{
   		$("#autoPushForce").attr("checked",false);
   	}
}

function doSelectRemoteStorageConfigEnable()
{
	var remoteStorageConfigEnable = $("#remoteStorageConfigEnable").is(':checked')? 1: 0;
	console.log("doSelectRemoteStorageConfigEnable remoteStorageConfigEnable:" + remoteStorageConfigEnable);
	if(remoteStorageConfigEnable == 0)
	{
		$("#remoteStorageConfigDiv").hide();
	}
	else
	{	
		$("#remoteStorageConfigDiv").show();
	}		
}

function doSelectRemoteStorageProtocol()
{
	var protocol = $("#remoteStorageProtocol").val();
	console.log("doSelectRemoteStorageProtocol protocol:" + protocol);
	if(protocol == undefined || protocol == "")
	{
		$("#remoteStorageProtocolConfig").hide();
		return;
	}
	
	var placeholder = getPlacehoderForRemoteStorageProtocol(protocol);
	$("#remoteStorage").attr('placeholder',placeholder);
	$("#remoteStorageProtocolConfig").show();
}

function getRemoteStorageConfig()
{   
	var remoteStorageConfigEnable = $("#remoteStorageConfigEnable").is(':checked')? 1: 0;
	console.log("getRemoteStorageConfig remoteStorageConfigEnable:" + remoteStorageConfigEnable);
	if(remoteStorageConfigEnable == 0)
	{
		return "none";
	}
	
	var protocol = $("#remoteStorageProtocol").val();
	console.log("getRemoteStorageConfig protocol:" + protocol);
	if(protocol == undefined || protocol == "")
	{
		return "none";
	}
	
	var prefix = "";
	switch(protocol)
	{
	case "svn":
		prefix = "svn://";
		break;
	case "git":
		prefix = "git://";
		break;
	}
	
    var remoteStorage = $("#remoteStorage").val();	//remoteStorage
	var autoPull = $("#autoPull").is(':checked')? 1: 0;
	var autoPullForce = $("#autoPullForce").is(':checked')? 1: 0;
	var autoPush = $("#autoPush").is(':checked')? 1: 0;
	var autoPushForce = $("#autoPushForce").is(':checked')? 1: 0;
    if(remoteStorage != undefined && remoteStorage != "")
	{
    	remoteStorage += ";autoPull=" + autoPull + ";autoPullForce=" + autoPullForce + ";autoPush=" + autoPush + ";autoPushForce=" + autoPushForce;
		remoteStorage = prefix + remoteStorage;
	}
    console.log("getRemoteStorageConfig remoteStorage:" + remoteStorage);
	return remoteStorage;
}

/****** 全文搜索  *****/
function showTextSearchConfig(reposInfo)
{	
	console.log("showTextSearchConfig textSearchConfig:", reposInfo.textSearchConfig);
	if(reposInfo.textSearchConfig == undefined)
   	{
		$("#isTextSearchEnabled").attr("checked",false);
   	}
	else
	{
		var enable = reposInfo.textSearchConfig.enable;
		if(enable == undefined || enable == false)
		{
			$("#isTextSearchEnabled").attr("checked",false);
		}
		else
		{
			$("#isTextSearchEnabled").attr("checked","checked");
		}
	}
	
	reposInfo.textSearch = getTextSearchConfig();
	console.log("reposInfo.textSearch:" + reposInfo.textSearch);
}	

/******* 自动备份 *************/
function showAutoBackupConfig(reposInfo)
{
	if(reposInfo.backupConfig == undefined)
   	{
		$("#autoBackupConfigDiv").hide();
   		$("#autoBackupEnable").attr("checked",false);
	}
	else
	{	
		if(reposInfo.backupConfig.localBackupConfig == undefined && 
			reposInfo.backupConfig.remoteBackupConfig == undefined)
		{
			$("#autoBackupConfigDiv").hide();
	   		$("#autoBackupEnable").attr("checked",false);
		}
		else
		{
			
			$("#autoBackupConfigDiv").show();
			$("#autoBackupEnable").attr("checked", "checked");
			
			showLocalBackupConfig(reposInfo.backupConfig.localBackupConfig);
			showRemoteBackupConfig(reposInfo.backupConfig.remoteBackupConfig);
		}
	}
	
	//init autoBackup
	reposInfo.autoBackup = getAutoBackupConfig();
	console.log("reposInfo.autoBackup:" + reposInfo.autoBackup);
}

function showLocalBackupConfig(localBackupConfig)
{
	if(localBackupConfig == undefined)
   	{
		$("#localBackupConfig").hide();
   		$("#localBackupEnable").attr("checked",false);
		return;
   	}
	
	$("#localBackupConfig").show();
	$("#localBackupEnable").attr("checked", "checked");	
	
	if(localBackupConfig.remoteStorageConfig && localBackupConfig.remoteStorageConfig.FILE &&  localBackupConfig.remoteStorageConfig.FILE.localRootPath)
	{
		$("#localBackupRootPath").val(localBackupConfig.remoteStorageConfig.FILE.localRootPath);
	}
	
	if(localBackupConfig.backupTime)
	{
		$("#localBackupTime option[value='" + localBackupConfig.backupTime + "']").attr("selected","selected");	
	}
	
	if(localBackupConfig.realTimeBackup == undefined || localBackupConfig.realTimeBackup == 0)
	{
		$("#localBackup-realTimeBackupEnable").attr("checked", false);		
	}	
	else
	{
		$("#localBackup-realTimeBackupEnable").attr("checked", "checked");				
	}
	
	if(localBackupConfig.weekDay1 == undefined || localBackupConfig.weekDay1 == 0)
	{	
		$("#localBackupWeekDay1").attr("checked", false);
	}
	else
	{
		$("#localBackupWeekDay1").attr("checked", "checked");		
	}
	
	if(localBackupConfig.weekDay2 == undefined || localBackupConfig.weekDay2 == 0)
	{	
		$("#localBackupWeekDay2").attr("checked", false);
	}
	else
	{
		$("#localBackupWeekDay2").attr("checked", "checked");		
	}
	
	if(localBackupConfig.weekDay3 == undefined || localBackupConfig.weekDay3 == 0)
	{	
		$("#localBackupWeekDay3").attr("checked", false);
	}
	else
	{
		$("#localBackupWeekDay3").attr("checked", "checked");		
	}
	
	if(localBackupConfig.weekDay4 == undefined || localBackupConfig.weekDay4 == 0)
	{	
		$("#localBackupWeekDay4").attr("checked", false);
	}
	else
	{
		$("#localBackupWeekDay4").attr("checked", "checked");		
	}
	
	if(localBackupConfig.weekDay5 == undefined || localBackupConfig.weekDay5 == 0)
	{	
		$("#localBackupWeekDay5").attr("checked", false);
	}
	else
	{
		$("#localBackupWeekDay5").attr("checked", "checked");		
	}
	
	if(localBackupConfig.weekDay6 == undefined || localBackupConfig.weekDay6 == 0)
	{	
		$("#localBackupWeekDay6").attr("checked", false);
	}
	else
	{
		$("#localBackupWeekDay6").attr("checked", "checked");		
	}
	
	if(localBackupConfig.weekDay7 == undefined || localBackupConfig.weekDay7 == 0)
	{	
		$("#localBackupWeekDay7").attr("checked", false);
	}
	else
	{
		$("#localBackupWeekDay7").attr("checked", "checked");		
	}
}

function showRemoteBackupConfig(remoteBackupConfig)
{
	if(remoteBackupConfig == undefined)
   	{
		$("#remoteBackupConfig").hide();
   		$("#remoteBackupEnable").attr("checked",false);
		return;
   	}
	
	if(remoteBackupConfig.remoteStorageConfig == undefined)
   	{
		$("#remoteBackupStorageConfig").hide();
		$("#remoteBackupStorageProtocol option[value='']").attr("selected","selected");		
		return;
   	}
	
	$("#remoteBackupConfig").show();
	$("#remoteBackupEnable").attr("checked", "checked");
	
	showRemoteBackupRemoteStorageConfig(remoteBackupConfig.remoteStorageConfig);
	
	var backupTime = remoteBackupConfig.backupTime;
	console.log("showRemoteBackupConfig() backupTime:" + backupTime);
	if(backupTime)
	{
		$("#remoteBackupTime option[value='" + backupTime + "']").attr("selected","selected");		
	}
	
	if(remoteBackupConfig.realTimeBackup == undefined || remoteBackupConfig.realTimeBackup == 0)
	{
		$("#remoteBackup-realTimeBackupEnable").attr("checked", false);		
	}	
	else
	{
		$("#remoteBackup-realTimeBackupEnable").attr("checked", "checked");				
	}
	
	if(remoteBackupConfig.weekDay1 == undefined || remoteBackupConfig.weekDay1 == 0)
	{	
		$("#remoteBackupWeekDay1").attr("checked", false);
	}
	else
	{
		$("#remoteBackupWeekDay1").attr("checked", "checked");		
	}
	
	if(remoteBackupConfig.weekDay2 == undefined || remoteBackupConfig.weekDay2 == 0)
	{	
		$("#remoteBackupWeekDay2").attr("checked", false);
	}
	else
	{
		$("#remoteBackupWeekDay2").attr("checked", "checked");		
	}
	
	if(remoteBackupConfig.weekDay3 == undefined || remoteBackupConfig.weekDay3 == 0)
	{	
		$("#remoteBackupWeekDay3").attr("checked", false);
	}
	else
	{
		$("#remoteBackupWeekDay3").attr("checked", "checked");		
	}
	
	if(remoteBackupConfig.weekDay4 == undefined || remoteBackupConfig.weekDay4 == 0)
	{	
		$("#remoteBackupWeekDay4").attr("checked", false);
	}
	else
	{
		$("#remoteBackupWeekDay4").attr("checked", "checked");		
	}
	
	if(remoteBackupConfig.weekDay5 == undefined || remoteBackupConfig.weekDay5 == 0)
	{	
		$("#remoteBackupWeekDay5").attr("checked", false);
	}
	else
	{
		$("#remoteBackupWeekDay5").attr("checked", "checked");		
	}
	
	if(remoteBackupConfig.weekDay6 == undefined || remoteBackupConfig.weekDay6 == 0)
	{	
		$("#remoteBackupWeekDay6").attr("checked", false);
	}
	else
	{
		$("#remoteBackupWeekDay6").attr("checked", "checked");		
	}
	
	if(remoteBackupConfig.weekDay7 == undefined || remoteBackupConfig.weekDay7 == 0)
	{	
		$("#remoteBackupWeekDay7").attr("checked", false);
	}
	else
	{
		$("#remoteBackupWeekDay7").attr("checked", "checked");		
	}
	
	//显示高级选项
	showRemoteBackFilterConfig(remoteBackupConfig);
}

function showRemoteBackFilterConfig(remoteBackupConfig)
{
	console.log("showRemoteBackFilterConfig remoteBackupConfig:", remoteBackupConfig);
	if(remoteBackupConfig.remoteStorageConfig == undefined)
	{
		return;
	}
	
	var remoteStorageConfig = remoteBackupConfig.remoteStorageConfig;
	
	var remoteBackupFilterEnable = 0;
	
	if(remoteStorageConfig.isUnkownFileAllowed != undefined)
	{
		remoteBackupFilterEnable = 1;
		if(remoteStorageConfig.isUnkownFileAllowed == 0)
		{
   			$("#isUnkownFileAllowed").attr("checked", false);		
		}
		else
		{
   			$("#isUnkownFileAllowed").attr("checked","checked");		
		}
	}
	else
	{
		$("#isUnkownFileAllowed").attr("checked","checked");
	}
	
	if(remoteStorageConfig.allowedMaxFile != undefined)
	{
		remoteBackupFilterEnable = 1;
		$("#allowedMaxFile option[value='" + remoteStorageConfig.allowedMaxFile + "']").attr("selected","selected");	
	}
	else
	{
		$("#allowedMaxFile option[value='0']").attr("selected","selected");			
	}
	
	if(remoteStorageConfig.allowedFileTypeHashMap)
	{
		remoteBackupFilterEnable = 1;	
		var allowedFileTypeList = getAllowedFileTypeList(remoteStorageConfig.allowedFileTypeHashMap);
		$("#allowedFileTypeList").val(allowedFileTypeList);
	}
	
	if(remoteStorageConfig.notAllowedFileTypeHashMap)
	{
		remoteBackupFilterEnable = 1;
		var notAllowedFileTypeList = getNotAllowedFileTypeList(remoteStorageConfig.notAllowedFileTypeHashMap);
		$("#notAllowedFileTypeList").val(notAllowedFileTypeList);
	}
	
	if(remoteStorageConfig.notAllowedFileHashMap)
	{
		remoteBackupFilterEnable = 1;
		var notAllowedFileList = getNotAllowedFileList(remoteStorageConfig.notAllowedFileHashMap);
		$("#notAllowedFileList").val(notAllowedFileList);
	}
	
	if(remoteBackupFilterEnable == 0)
	{
		//隐藏高级选项
		$("#remoteBackupFilterConfig").hide();
   		$("#remoteBackupFilterEnable").attr("checked",false);
	}
	else
	{
		//显示高级选项
		$("#remoteBackupFilterConfig").show();
   		$("#remoteBackupFilterEnable").attr("checked","checked");		
	}
}

function getAllowedFileTypeList(allowedFileTypeHashMap)
{
	var listStr = "";
	for(var key in allowedFileTypeHashMap)
	{
		listStr += key + ";"
	}
	return listStr;
}

function getNotAllowedFileTypeList(notAllowedFileTypeHashMap)
{
	var listStr = "";
	for(var key in notAllowedFileTypeHashMap)
	{
		listStr += key + ";"
	}
	return listStr;
}

function getNotAllowedFileList(notAllowedFileHashMap)
{
	var listStr = "";
	for(var key in notAllowedFileHashMap)
	{
		listStr += key + ";"
	}
	return listStr;
}

function showRemoteBackupRemoteStorageConfig(remoteStorageConfig)
{
	var protocol = remoteStorageConfig.protocol;
	if(protocol == undefined || protocol == "")
	{
		$("#remoteBackupStorageConfig").hide();
		$("#remoteBackupStorageProtocol option[value='']").attr("selected","selected");			
		return;
	}
	
	$("#remoteBackupStorageConfig").show();			
	$("#remoteBackupStorageProtocol option[value='" + protocol + "']").attr("selected","selected");	
	
	var remoteStorage = buildRemoteStorageConfigStr(remoteStorageConfig);
	$("#remoteBackupStorage").val(remoteStorage);
}

function doSelectAutoBackupConfigEanble()
{
	var autoBackupEnable = $("#autoBackupEnable").is(':checked')? 1: 0;
	console.log("doSelectAutoBackupConfigEanble autoBackupEnable:" + autoBackupEnable);
	if(autoBackupEnable == 0)
	{
		$("#autoBackupConfigDiv").hide();
	}
	else
	{	
		$("#autoBackupConfigDiv").show();
	}		
}

function doSelectLocalBackupEnable()
{
	var localBackupEnable = $("#localBackupEnable").is(':checked')? 1: 0;
	console.log("doSelectLocalBackupEnable localBackupEnable:" + localBackupEnable);
	if(localBackupEnable == 0)
	{
		$("#localBackupConfig").hide();
	}
	else
	{	
		$("#localBackupConfig").show();
	}		
}

function doSelectRemoteBackupEnable()
{
	var remoteBackupEnable = $("#remoteBackupEnable").is(':checked')? 1: 0;
	console.log("doSelectRemoteBackupEnable remoteBackupEnable:" + remoteBackupEnable);
	if(remoteBackupEnable == 0)
	{
		$("#remoteBackupConfig").hide();
	}
	else
	{	
		$("#remoteBackupConfig").show();
	}		
}

function doSelectRemoteBackupStorageProtocol()
{
	var protocol = $("#remoteBackupStorageProtocol").val();
	console.log("doSelectRemoteBackupStorageProtocol protocol:" + protocol);
	if(protocol == undefined || protocol == "")
	{
		$("#remoteBackupStorageConfig").hide();
		return;
	}

	var placeholder = getPlacehoderForRemoteStorageProtocol(protocol);
	$("#remoteBackupStorage").attr('placeholder',placeholder);
	$("#remoteBackupStorageConfig").show();
}

/** 异地备份高级选项 **/
function doSelectRemoteBackupFilterEnable()
{
	var enable = $("#remoteBackupFilterEnable").is(':checked')? 1: 0;
	console.log("doSelectRemoteBackupFilterEnable enable:" + enable);
	if(enable == 0)
	{
		$("#remoteBackupFilterConfig").hide();
	}
	else
	{	
		$("#remoteBackupFilterConfig").show();
	}
}

function getTextSearchConfig()
{   
	var isTextSearchEnabled = $("#isTextSearchEnabled").is(':checked')? 1: 0;
	console.log("getTextSearchConfig isTextSearchEnabled:" + isTextSearchEnabled);
	var config = "{enable:" + isTextSearchEnabled + "}";
	return config;
}

function getAutoBackupConfig()
{   
	var autoBackupEnable = $("#autoBackupEnable").is(':checked')? 1: 0;
	console.log("getAutoBackupConfig autoBackupEnable:" + autoBackupEnable);
	if(autoBackupEnable == 0)
	{
		return "{localBackup:{},remoteBackup:{}}";
	}
	
	var localBackupConfig = getLocalBackupConfig();
	var remoteBackupConfig = getRemoteBackupConfig();
	return "{localBackup:" + localBackupConfig + ",remoteBackup:" + remoteBackupConfig + "}";
}
	
function getLocalBackupConfig()
{
	var localBackupEnable = $("#localBackupEnable").is(':checked')? 1: 0;
	console.log("getLocalBackupConfig localBackupEnable:" + localBackupEnable);
	if(localBackupEnable == 0)
	{
		return "{}";
	}
	
	var localRootPath = $("#localBackupRootPath").val();
	if(localRootPath == undefined || localRootPath == "")
	{
		return "{}";
	}

	var backupTime = $("#localBackupTime").val();;
    var weekDay1 = $("#localBackupWeekDay1").is(':checked')? 1: 0;
    var weekDay2 = $("#localBackupWeekDay2").is(':checked')? 1: 0;
    var weekDay3 = $("#localBackupWeekDay3").is(':checked')? 1: 0;
    var weekDay4 = $("#localBackupWeekDay4").is(':checked')? 1: 0;
    var weekDay5 = $("#localBackupWeekDay5").is(':checked')? 1: 0;
    var weekDay6 = $("#localBackupWeekDay6").is(':checked')? 1: 0;
    var weekDay7 = $("#localBackupWeekDay7").is(':checked')? 1: 0;
    var realTimeBackup = $("#localBackup-realTimeBackupEnable").is(':checked')? 1: 0;

	var localBackupConfig = 
	"{" +
		"backupTime:" + backupTime + "," +
		"weekDay1:" + weekDay1 +"," + 
		"weekDay2:" + weekDay2 +"," + 
		"weekDay3:" + weekDay3 +"," + 
		"weekDay4:" + weekDay4 +"," + 
		"weekDay5:" + weekDay5 +"," + 
		"weekDay6:" + weekDay6 +"," + 
		"weekDay7:" + weekDay7 +"," + 
		"realTimeBackup:" + realTimeBackup + "," +
		"localRootPath:\"" + localRootPath + "\"" + 
	"}";
	return localBackupConfig;
}

function getRemoteBackupConfig()
{
	var remoteBackupEnable = $("#remoteBackupEnable").is(':checked')? 1: 0;
	console.log("getRemoteBackupConfig remoteBackupEnable:" + remoteBackupEnable);
	if(remoteBackupEnable == 0)
	{
		return "{}";
	}
	
	var remoteStorage = getRemoteBackupRemoteStorageConfig();
	if(remoteStorage == "")
	{
		return "{}";
	}
	
	var backupTime = $("#remoteBackupTime").val();
    var weekDay1 = $("#remoteBackupWeekDay1").is(':checked')? 1: 0;
    var weekDay2 = $("#remoteBackupWeekDay2").is(':checked')? 1: 0;
    var weekDay3 = $("#remoteBackupWeekDay3").is(':checked')? 1: 0;
    var weekDay4 = $("#remoteBackupWeekDay4").is(':checked')? 1: 0;
    var weekDay5 = $("#remoteBackupWeekDay5").is(':checked')? 1: 0;
    var weekDay6 = $("#remoteBackupWeekDay6").is(':checked')? 1: 0;
    var weekDay7 = $("#remoteBackupWeekDay7").is(':checked')? 1: 0;
    var realTimeBackup = $("#remoteBackup-realTimeBackupEnable").is(':checked')? 1: 0;
		
    //高级选项
    var isUnkownFileAllowed = "";
    var allowedMaxFile = "";
    var allowedFileTypeList = "";
    var notAllowedFileTypeList = "";
    var notAllowedFileList = "";
	var remoteBackupFilterEnable = $("#remoteBackupFilterEnable").is(':checked')? 1: 0;
	console.log("getRemoteBackupConfig remoteBackupFilterEnable:" + remoteBackupFilterEnable);
	if(remoteBackupFilterEnable == 1)
	{
		isUnkownFileAllowed = $("#isUnkownFileAllowed").is(':checked')? 1: 0;
	    allowedMaxFile = $("#allowedMaxFile").val();
	    allowedFileTypeList = $("#allowedFileTypeList").val();
	    notAllowedFileTypeList = $("#notAllowedFileTypeList").val();
	    notAllowedFileList = $("#notAllowedFileList").val();
	}
    
    var remoteBackupConfig = 
	"{" +
		"backupTime:" + backupTime + ","  + 
		"weekDay1:" + weekDay1 +"," + 
		"weekDay2:" + weekDay2 +"," + 
		"weekDay3:" + weekDay3 +"," + 
		"weekDay4:" + weekDay4 +"," + 
		"weekDay5:" + weekDay5 +"," + 
		"weekDay6:" + weekDay6 +"," + 
		"weekDay7:" + weekDay7 +"," + 
		"realTimeBackup:" + realTimeBackup + "," +
		"isUnkownFileAllowed:\"" + isUnkownFileAllowed + "\"," +	
		"allowedMaxFile:\"" + allowedMaxFile + "\"," +
		"allowedFileTypeList:\"" + allowedFileTypeList + "\"," +
		"notAllowedFileTypeList:\"" + notAllowedFileTypeList + "\"," +
		"notAllowedFileList:\"" + notAllowedFileList + "\"," +
		"remoteStorage:\"" + remoteStorage + "\"" +
	"}";
	
	return remoteBackupConfig;
}

function getRemoteBackupRemoteStorageConfig()
{
	var protocol = $("#remoteBackupStorageProtocol").val();
	console.log("getRemoteBackupRemoteStorageConfig protocol:" + protocol);
	if(protocol == undefined || protocol == "")
	{
		return "";
	}
	
	var prefix = "";
	switch(protocol)
	{
	case "svn":
		prefix = "svn://";
		break;
	case "git":
		prefix = "git://";
		break;
	case "mxsdoc":
		prefix = "mxsdoc://";
		break;
	}
	
    var remoteStorage = $("#remoteBackupStorage").val();	//remoteStorage
    if(remoteStorage != undefined && remoteStorage != "")
	{
    	remoteStorage = prefix + remoteStorage;
	}
    console.log("getRemoteBackupRemoteStorageConfig remoteStorage:" + remoteStorage);
	return remoteStorage;
}	

</script>
