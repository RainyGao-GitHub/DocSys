<div id="dialog-new-repos" class="form-horizontal">
	<div class="modal-body">
        <div class="form-group">
        	<div>
	        	<label>仓库名字</label>
            	<input class="form-control" type="text" name="name" style="width: 100%"/>
            </div>

        	<div style="margin-top:10px">            
	            <label>仓库简介</label>
    	        <textarea class="form-control" type="text" name="info" style="width: 100%"/>
        	</div>

        	<div style="margin-top:10px">            
	        	<label>仓库类型</label>
            	<select class="form-control" name="type" onchange="doSelectFS();" style="width: 100%">   
            		<option value="1" selected="selected">文件管理系统</option>   
            		<option value="5">文件服务器前置</option>
            	</select>
			</div> 

			<div name="remoteServerDiv" style="margin-top:10px"  style="display:none">
				<label>文件服务器</label>
				<div style="height: 40px">
					<select class="form-control" name="remoteServerProtocol" onchange="doSelectRemoteServerProtocol();" style="width:87%">   
			        	<option value="ftp">FTP</option>   
			            <option value="sftp">SFTP</option>   
			            <option value="smb">SMB</option>  
			            <option value="svn">SVN</option>  
			            <option value="git">GIT</option>  
			            <option value="mxsdoc">MXSDOC</option>  
			        </select>
			        <button  type="button" class="btn btnPrimary" onclick="doRemoteSeverTest()" style="position: relative;top:-33px;left:90%">测试</button>
				</div>
				<input class="form-control" type="text" name="remoteServer"  placeholder="ftp://192.168.0.1:21;userName=test;pwd=123456"  value="" style="width:100%"/>
			</div>  
			
	        <div name="reposStorageConfig" style="margin-top:10px">
				<label>仓库位置 
					<!-- <span style="margin-left:20px">
						<input type="checkbox" name="reposStoragePathEnable" value="0" onclick="doSelectReposStoragePathEnable()">自定义
					</span>  --> 
				</label>
				<div name="reposStoragePathConfig">
					<input class="form-control" type="text" name="path"  value="" style="width: 100%" disabled="disabled"/>
			    </div>
			    <label>文件存储位置
			    	<span style="margin-left:20px">
						<input type="checkbox" name="reposStorageRealDocPathEnable" value="0" onclick="doSelectReposStorageRealDocPathEnable()">自定义
					</span> 
			    </label>
				<div name="reposStorageRealDocPathConfig" style="display:none">
					<input class="form-control" type="text" name="realDocPath"  placeholder="如使用默认位置，请留空！"  value="" style="width: 100%"/>
				</div>
			</div>
			
        	<div name="remoteStorageDiv" style="margin-top:20px">
	        	<label>远程存储
	        		<span style="margin-left:5px">
	            		<input type="checkbox" name="remoteStorageConfigEnable" value="0" onclick="doSelectRemoteStorageConfigEnable()">
	            	</span>
				</label>
				
				<div name="remoteStorageConfigDiv" style="display:none">
					<div style="height: 40px">
						<select class="form-control" name="remoteStorageProtocol" onchange="doSelectRemoteStorageProtocol();" style="width:87%">   
				        	<option value="">无</option>
				            <option value="ftp">FTP</option>   
				            <option value="sftp">SFTP</option>   
				            <option value="smb">SMB</option>  
				            <option value="svn">SVN</option>  
				            <option value="git">GIT</option>  
				            <option value="mxsdoc">MXSDOC</option>  
				        </select>
	            		<button  type="button" class="btn btnPrimary" onclick="doRemoteStorageTest()" style="position: relative;top:-33px;left:90%">测试</button>
				    </div>
					<div name="remoteStorageProtocolConfig" style="margin-top:10px; display:none">
			           	<input class="form-control" type="text" name="remoteStorage"  placeholder="ftp://192.168.0.1:21;userName=test;pwd=123456"  value="" style="width:100%"/>
	            		<label style="margin-left:1px">自动拉取 <span style="margin-left:3px"><input type="checkbox" name="autoPull" value="0"></span></label>
	            		<label style="margin-left:10px">强制拉取 <span style="margin-left:3px"><input type="checkbox" name="autoPullForce" value="0"></span></label>
	            		<label style="margin-left:15px">自动推送 <span style="margin-left:3px"><input type="checkbox" name="autoPush" value="0"></span></label>
	            		<label style="margin-left:10px">强制推送 <span style="margin-left:3px"><input type="checkbox" name="autoPushForce" value="0"></span></label>
					</div>
				</div>
			</div>        	
        	
        	<div name="verCtrlDiv">
	        	<div name="verCtrlEnablelDiv" style="margin-top:10px">
		            <label>版本管理 
		            	<span style="margin-left:5px">
		            		<input type="checkbox" name="verCtrlEnable" value="0" onclick="doSelectVerCtrlEnable()">
		            	</span>
		            </label>
		            <span name="showVerCtrlConfig" value="0" style="margin-left:20px;display:none" onclick="doSelectShowVerCtrlConfig()">显示高级选项</span>
				</div>
				
				<div name="verCtrlConfigDiv" style="margin-left:20px;margin-top:10px;display:none">
		            <label>版本仓库类型 <span name="isRemoteSetting" style="margin-left:20px"><input type="checkbox" name="isRemote" value="0" onclick="doSelectVerCtrl()">自定义</span></label>
		            <select class="form-control" name="verCtrl" onchange="doSelectVerCtrl();" style="width: 100%">   
		            	<option value="0">无</option>   
		            	<option value="1">SVN</option>   
		            	<option value="2">GIT</option>   
		            </select>
		            <div name="realDocVerCtrlConfigDiv">
			            <div name="verReposSetting">
				            <div name="localVerRepos">
					            <label>版本仓库所在目录</label>
					            <input class="form-control" type="text" name="localSvnPath"  placeholder="如使用系统默认位置，请留空！"  value="" style="width: 100%"/>
				            </div>
				            <div name="remoteVerRepos">
					            <label>版本仓库链接</label>
					            <div style="height:40px;">
					            	<input class="form-control" type="text" name="svnPath"  placeholder="请填写版本仓库链接！" value="" style="width: 87%"/>
					            	<button  type="button" class="btn btnPrimary" onclick="doVerReposTest()" style="position: relative;top:-33px;left:90%">测试</button>
					            </div>
					            <label>用户名</label>
					            <input class="form-control" type="text" name="svnUser"  value="" style="width: 100%"/>
					            <label>密码</label>
				            	<input class="form-control" type="password" name="svnPwd" value="" style="width: 100%"/>           
				            </div>
			            </div>
		            </div>
		        </div>
		   	</div>
	        
	        <div name="virtualDocVerCtrlConfigDiv" style="display:none">
		    	<label>备注版本管理<span name="isRemoteSetting1" style="margin-left:20px"><input  type="checkbox" name="isRemote1" value="0" onclick="doSelectVerCtrl1()">自定义</span></label>
		        <select class="form-control" name="verCtrl1" onchange="doSelectVerCtrl1();" style="width: 100%">   
	            	<option value="0">无</option>   
	            	<option value="1">SVN</option>   
	            	<option value="2">GIT</option>  
		        </select>
		        <div name="verReposSetting1">
		            <div name="localVerRepos1">            
			            <label>版本仓库所在目录</label>
			            <input class="form-control" type="text" name="localSvnPath1"  placeholder="如使用系统默认位置，请留空！" value="" style="width: 100%"/>
	            	</div>
	            	<div name="remoteVerRepos1">
			            <label>版本仓库链接</label>
			            <div style="height:40px;">
			            	<input class="form-control" type="text" name="svnPath1"  placeholder="请填写版本仓库链接！" value="" style="width: 87%"/>
			        		<button  type="button" class="btn btnPrimary" onclick="doVerReposTest1()" style="position: relative;top:-33px;left:90%">测试</button>
			            </div>
			            <label>用户名</label>
			            <input class="form-control" type="text" name="svnUser1"  value="" style="width: 100%"/>
			            <label>密码</label>
			            <input class="form-control" type="password" name="svnPwd1" value="" style="width: 100%"/>          
			        </div>
				</div>
			</div>
					
			<div name="textSearchEnablelDiv" style="margin-top:10px">
	            <label>全文搜索 <span style="margin-left:5px"><input type="checkbox" name="isTextSearchEnabled" value="0"></span></label>
			</div>
			<div name="encryptEnablelDiv" style="margin-top:10px">
	            <label>文件加密 <span style="margin-left:5px"><input type="checkbox" name="isEncryptEnabled" value="0"></span></label>
			</div>
			
			<div name="autoBackupEnablelDiv" style="margin-top:10px">
	            <label>自动备份 
	            	<span style="margin-left:5px">
	            		<input type="checkbox" name="autoBackupEnable" value="0" onclick="doSelectAutoBackupConfigEanble()">
	            	</span>
	            </label>
			</div>
			
			<div name="autoBackupConfigDiv" style="margin-left:20px;margin-top:10px;display:none">
	            <label>本地备份
	            	<span style="margin-left:5px">
	            		<input type="checkbox" name="localBackupEnable" value="0" onclick="doSelectLocalBackupEnable()">
	            	</span>
	            </label>
	            <div name="localBackupConfig" style="display:none">
				    <input class="form-control" type="text" name="localBackupRootPath"  placeholder="请填写备份存储路径！" value="" style="width: 100%"/>
    				<label style="margin-top:5px">备份时间</label>
		        	<select class="form-control" name="localBackupTime" style="width:100%">   
				        <option value="0">0:00</option>   
				        <option value="60">1:00</option>   
				        <option value="120">2:00</option>   
				        <option value="180">3:00</option>  
				        <option value="240">4:00</option>  
				        <option value="300">5:00</option>  
				        <option value="360">6:00</option>  
				        <option value="420">7:00</option>  
				        <option value="480">8:00</option>  
				        <option value="540">9:00</option>  
				        <option value="600">10:00</option>
				        <option value="660">11:00</option>
				        <option value="720">12:00</option>
				        <option value="780">13:00</option>
				        <option value="840">14:00</option>
				        <option value="900">15:00</option>
				        <option value="960">16:00</option>
				        <option value="1020">17:00</option>
				        <option value="1080">18:00</option>
				        <option value="1140">19:00</option>
				        <option value="1200">20:00</option>
				        <option value="1260">21:00</option>
				        <option value="1320">22:00</option>
				        <option value="1380">23:00</option>
				    </select>
					<label style="margin-top:5px">备份周期</label>
					<div>
						<span><input type="checkbox" name="localBackupWeekDay1" value="0">周一</span>
						<span style="margin-left:20px"><input type="checkbox" name="localBackupWeekDay2" value="0">周二</span>
						<span style="margin-left:20px"><input type="checkbox" name="localBackupWeekDay3" value="0">周三</span>
						<span style="margin-left:20px"><input type="checkbox" name="localBackupWeekDay4" value="0">周四</span>
						<span style="margin-left:20px"><input type="checkbox" name="localBackupWeekDay5" value="0">周五</span>
						<span style="margin-left:20px"><input type="checkbox" name="localBackupWeekDay6" value="0">周六</span>
						<span style="margin-left:20px"><input type="checkbox" name="localBackupWeekDay7" value="0">周日</span>
					</div>				    
		            <label style="margin-top:5px">开启实时备份		            	
		            	<span style="margin-left:5px">
	            			<input type="checkbox" name="localRealTimeBackupEnable" value="0">
	            		</span>
		            </label>		            
	            </div>

				<br>

	            <label style="margin-top:10px">异地备份 
	            	<span style="margin-left:5px;">
	            		<input type="checkbox" name="remoteBackupEnable" value="0" onclick="doSelectRemoteBackupEnable()">
	            	</span>
	            </label>
	            <div name="remoteBackupConfig" style="display:none">
	            	<div style="height:40px;">
			        	<select class="form-control" name="remoteBackupStorageProtocol" onchange="doSelectRemoteBackupStorageProtocol();" style="width:87%">   
					        <option value="">无</option>
					        <option value="ftp">FTP</option>   
					        <option value="sftp">SFTP</option>   
					        <option value="smb">SMB</option>  
					        <option value="svn">SVN</option>  
					        <option value="git">GIT</option>  
					        <option value="mxsdoc">MXSDOC</option>  
					    </select>
			        	<button  type="button" class="btn btnPrimary" onclick="doRemoteBackupStorageTest()" style="position: relative;top:-33px;left:90%">测试</button>
				    </div>
				    <div name="remoteBackupStorageConfig" style="margin-top:10px; display:none">
		           		<input class="form-control" type="text" name="remoteBackupStorage"  placeholder="ftp://192.168.0.1:21;userName=test;pwd=123456"  value="" style="width:100%"/>
	    				<label style="margin-top:5px">备份时间</label>
			        	<select class="form-control" name="remoteBackupTime" style="width:100%">   
					        <option value="0">0:00</option>   
					        <option value="60">1:00</option>   
					        <option value="120">2:00</option>   
					        <option value="180">3:00</option>  
					        <option value="240">4:00</option>  
					        <option value="300">5:00</option>  
					        <option value="360">6:00</option>  
					        <option value="420">7:00</option>  
					        <option value="480">8:00</option>  
					        <option value="540">9:00</option>  
					        <option value="600">10:00</option>
					        <option value="660">11:00</option>
					        <option value="720">12:00</option>
					        <option value="780">13:00</option>
					        <option value="840">14:00</option>
					        <option value="900">15:00</option>
					        <option value="960">16:00</option>
					        <option value="1020">17:00</option>
					        <option value="1080">18:00</option>
					        <option value="1140">19:00</option>
					        <option value="1200">20:00</option>
					        <option value="1260">21:00</option>
					        <option value="1320">22:00</option>
					        <option value="1380">23:00</option>
					    </select>
						<label style="margin-top:5px">备份周期</label>
						<div>
							<span><input type="checkbox" name="remoteBackupWeekDay1" value="0">周一</span>
							<span style="margin-left:20px"><input type="checkbox" name="remoteBackupWeekDay2" value="0">周二</span>
							<span style="margin-left:20px"><input type="checkbox" name="remoteBackupWeekDay3" value="0">周三</span>
							<span style="margin-left:20px"><input type="checkbox" name="remoteBackupWeekDay4" value="0">周四</span>
							<span style="margin-left:20px"><input type="checkbox" name="remoteBackupWeekDay5" value="0">周五</span>
							<span style="margin-left:20px"><input type="checkbox" name="remoteBackupWeekDay6" value="0">周六</span>
							<span style="margin-left:20px"><input type="checkbox" name="remoteBackupWeekDay7" value="0">周日</span>
						</div>
		            	
		            	<label style="margin-top:10px">高级选项
		            		<span style="margin-left:5px">
		            			<input type="checkbox" name="remoteBackupFilterEnable" value="0" onclick="doSelectRemoteBackupFilterEnable()">
		            		</span>
		            	</label>
						<div name="remoteBackupFilterConfig" style="margin-top:5px; display:none">
							<div style="height:60px;">
								<span style="margin-top:5px">允许的最大文件</span>
								<select class="form-control" name="allowedMaxFile" style="position: relative;top:-33px;left:25%; width:75%">  
							        <option value="10485760">10M</option>   
							        <option value="20971520">20M</option>   
							        <option value="52428800">50M</option>   
							        <option value="104857600">100M</option>  
							        <option value="209715200">200M</option>  
							        <option value="524288000">500M</option>  
							        <option value="1073741824">1G</option>  
							        <option value="2147483648">2G</option>  
							        <option value="4294967296">4G</option>  
							        <option value="NoLimit">不限</option>  
							    </select>
							</div>      
							<div style="height:60px;">
								<span style="margin-top:5px">允许的文件类型</span>
								<textarea class="form-control" type="text" name="allowedFileTypeList" style="position: relative;top:-33px;left:25%; width:75%"/>
							</div>  
							<div style="height:60px;">
								<span style="margin-top:5px">不允许的文件类型</span>
								<textarea class="form-control" type="text" name="notAllowedFileTypeList" style="position: relative;top:-33px;left:25%; width:75%"/>
							</div>  
							<div style="height:60px;">
								<span style="margin-top:5px">不允许的文件</span>
								<textarea class="form-control" type="text" name="notAllowedFileList" style="position: relative;top:-33px;left:25%; width:75%"/>
							</div>  
						</div>
						<div></div>
						
			            <label style="margin-top:10px">开启实时备份
			            	<span style="margin-left:5px">
		            			<input type="checkbox" name="remoteRealTimeBackupEnable" value="0">
		            		</span>
		            	</label>		
		            </div>      
	            </div>
			</div>
        </div>
    </div>
    
    <div class="modal-footer">
	    <div class="form-group">
		    <div class="col-sm-12 text-right">
		        <button  type="button" class="btn btnPrimary" onclick="doAddRepos();" style="width: 100px;height: 42px;">确定</button>
		        <button  type="button" class="btn btnPrimary" onclick="cancelAddRepos();" style="width: 100px;height: 42px;">取消</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript" src="js/remoteStorageCommon.js"></script>
<script type="text/javascript">
	function addReposPageInit(_type, _parentNode)
	{
			console.log("addReposPageInit()");
            $("#dialog-new-repos input[name='name']").focus();

            //alert(login_user.type);
            var defaultReposStorePath =  gDocSysConfig.defaultReposStorePath;
            var defaultLocalVerReposStorePath =  defaultReposStorePath + "DocSysVerReposes/";

            $("#dialog-new-repos input[name='path']").val(gDocSysConfig.defaultReposStorePath);
            //if(login_user.type == 2) //超级管理员，可以设置仓库路径
            //{
            	$("#dialog-new-repos input[name='path']").attr("disabled",false);
            //}
           
            doSelectFS(); 
            
            
            $("#dialog-new-repos input[name='localSvnPath']").val(defaultLocalVerReposStorePath);	//local VersionRepos Path
            $("#dialog-new-repos input[name='svnPath']").val("");	//置空
            $("#dialog-new-repos input[name='svnUser']").val("");
    		$("#dialog-new-repos input[name='svnPwd']").val("");
            $("#dialog-new-repos input[name='localSvnPath1']").val(defaultLocalVerReposStorePath);	//local VersionRepos Path
            $("#dialog-new-repos input[name='svnPath1']").val("");	//置空
            $("#dialog-new-repos input[name='svnUser1']").val("");
    		$("#dialog-new-repos input[name='svnPwd1']").val("");
	}
	
	function cancelAddRepos()
	{
		closeAddReposDialog();
		//临时方案避免滚动条消失
		window.location.reload();
	}
	
	function closeAddReposDialog()
	{
		closeBootstrapDialog("addRepos");
		//临时方案避免滚动条消失
		window.location.reload();
	}
	
	function doAddRepos()
	{
	    var name = $("#dialog-new-repos input[name='name']").val();
	    var info = $("#dialog-new-repos textarea[name='info']").val();
	    var path = $("#dialog-new-repos input[name='path']").val();	//仓库位置
	    var realDocPath = $("#dialog-new-repos input[name='realDocPath']").val();	//realDocPath
	    
	    var textSearch = getTextSearchConfig();
	    var encryptType = $("#dialog-new-repos input[name='isEncryptEnabled']").is(':checked')? 1: 0;
	    var autoBackupConfig = getAutoBackupConfig();	//autoBackupConfig
	    console.log("autoBackupConfig = " + autoBackupConfig);
	    
	    //Virtual Doc Version Control
	    var verCtrl1 = $("#dialog-new-repos select[name='verCtrl1']").val();
	    var isRemote1 = $("#dialog-new-repos input[name='isRemote1']").is(':checked')? 1: 0;
	    var localSvnPath1 = $("#dialog-new-repos input[name='localSvnPath1']").val();
	    var svnPath1 = $("#dialog-new-repos input[name='svnPath1']").val();
	    var svnUser1 = $("#dialog-new-repos input[name='svnUser1']").val();
	    var svnPwd1 = $("#dialog-new-repos input[name='svnPwd1']").val();
	    if(isRemote1 == 0)
		{
			localSvnPath1 =   path + "DocSysVerReposes/";        		
		}
	    //default to set VirtualDoc VersionControl as GIT
	    if(verCtrl1 == 0)
	    {
	    	verCtrl1 = 2;
	    }
	    
	    
		//前置服务器
	    var remoteServer = "";
	    //远程存储
		var remoteStorage = "";
	    //版本管理
	    var verCtrl = "";
	    var isRemote = 0;
	    var localSvnPath = "";
	    var svnPath = "";
	    var svnUser = "";
	    var svnPwd = "";
		
	    var type = $("#dialog-new-repos select[name='type']").val();	//1:文件管理系统  5:文件服务器前置
	    if(type == 1)
	    {
	    	//远程存储
		    remoteStorage = getRemoteStorageConfig();	//remoteStorage
		    //版本管理
		    verCtrl = $("#dialog-new-repos select[name='verCtrl']").val();
		    isRemote = $("#dialog-new-repos input[name='isRemote']").is(':checked')? 1: 0;
		    localSvnPath = $("#dialog-new-repos input[name='localSvnPath']").val();
		    svnPath = $("#dialog-new-repos input[name='svnPath']").val();
		    svnUser = $("#dialog-new-repos input[name='svnUser']").val();
		    svnPwd = $("#dialog-new-repos input[name='svnPwd']").val();
			if(isRemote == 0)
			{
				localSvnPath =   path + "DocSysVerReposes/";
			}
	    }
	    else
	    {
	    	remoteServer = getRemoteServerConfig();	//remoteServer
	    }
	    
	    var createTime = new Date().getTime();	//获取时间戳
	    
	    //alert("仓库名："+ name + " 仓库类型：" + type + " 仓库路径：" + path + " 仓库描述：" + info + " svnPath:" + svnPath + " svnUser:" + svnUser + " 创建时间：" + createTime);
		if(!name)
		{
	    	alert("仓库名不能为空！");
	    	return false;
		}
		if(!info)
		{
	    	alert("仓库简介不能为空！");
	    	return false;
		}
		if(!path)
		{
	    	alert("仓库存储路径不能为空！");
	    	return false;
		}
		
	    $.ajax({
	            url : "/DocSystem/Repos/addRepos.do",
	            type : "post",
	            dataType : "json",
	            data : {
	                name:name,
	                info:info,
	                type:type,
	                path:path,
	                realDocPath: realDocPath,
	                remoteServer: remoteServer,
	                remoteStorage: remoteStorage,
	                verCtrl: verCtrl,
	                isRemote: isRemote,
	                localSvnPath: localSvnPath,
	                svnPath: svnPath,
	                svnUser: svnUser,
	                svnPwd: svnPwd,
	                verCtrl1: verCtrl1,
	                isRemote1: isRemote1,
	                localSvnPath1: localSvnPath1,
	                svnPath1: svnPath1,
	                svnUser1: svnUser1,
	                svnPwd1: svnPwd1,
	                createTime:createTime,
	                textSearch: textSearch,
	                encryptType : encryptType,
	                autoBackup : autoBackupConfig,	                
	            },
	            success : function (ret) {
	            	if(ret.status == "ok")
	            	{
	            		console.log("创建仓库成功");
	                	onChange();
	                }
	                else
	                {
	                	showErrorMessage(ret.msgInfo);
	                }
	            },
	            error : function () {
	            	showErrorMessage('服务器异常: 创建仓库失败');
	            }
	        });
	    
	    closeAddReposDialog();
		//临时方案避免滚动条消失
		window.location.reload();
	    return true;
	}
	
	//文件系统类型改变时需要根据文件系统类型，显示或者不显示相关信息
	function doSelectFS()
	{
		var type = $("#dialog-new-repos select[name='type']").val();
		console.log("doSelectFS type:" + type);
		if(type == 1 || type == 2)
		{
			$("#dialog-new-repos div[name='remoteServerDiv']").hide();
			$("#dialog-new-repos div[name='remoteStorageDiv']").show();
			$("#dialog-new-repos div[name='verCtrlDiv']").show();
		}
		else
		{
			$("#dialog-new-repos div[name='remoteServerDiv']").show();
			$("#dialog-new-repos div[name='remoteStorageDiv']").hide();
			$("#dialog-new-repos div[name='verCtrlDiv']").hide();
		}
	}
	
	/** 版本管理设置 **/
	function doSelectVerCtrlEnable()
	{
		var verCtrlEnable = $("#dialog-new-repos input[name='verCtrlEnable']").is(':checked')? 1: 0;
		console.log("doSelectVerCtrlEnable verCtrlEnable:" + verCtrlEnable);
		if(verCtrlEnable == 0)
		{
			$("#dialog-new-repos select[name='verCtrl']").get(0).selectedIndex=0;	//关闭verCtrl

			$("#dialog-new-repos div[name='verCtrlConfigDiv']").hide();		//隐藏 高级选项
			
			$("#dialog-new-repos span[name='showVerCtrlConfig']").hide();	//隐藏 高级选项提示
			$("#dialog-new-repos span[name='showVerCtrlConfig']").val(0);
			$("#dialog-new-repos span[name='showVerCtrlConfig']").text("显示高级选项");
		}
		else
		{	
			if($("#dialog-new-repos select[name='verCtrl']").val() == 0)	//设置版本控制为GIT
			{
				$("#dialog-new-repos select[name='verCtrl']").get(0).selectedIndex=2;
			}
			
			$("#dialog-new-repos div[name='verCtrlConfigDiv']").hide();			//隐藏 高级选项
			
			$("#dialog-new-repos span[name='showVerCtrlConfig']").show();		//显示 高级选项提示
			$("#dialog-new-repos span[name='showVerCtrlConfig']").val(0);
			$("#dialog-new-repos span[name='showVerCtrlConfig']").text("显示高级选项");						
		}
		
		doSelectVerCtrl();
	}

	function doSelectShowVerCtrlConfig()
	{
		var showVerCtrlConfig = $("#dialog-new-repos span[name='showVerCtrlConfig']").val();
		console.log("doSelectShowVerCtrlConfig showVerCtrlConfig:" + showVerCtrlConfig);
		if(showVerCtrlConfig == 0)
		{
			$("#dialog-new-repos span[name='showVerCtrlConfig']").val(1);
			$("#dialog-new-repos span[name='showVerCtrlConfig']").text("隐藏高级选项");
			$("#dialog-new-repos div[name='verCtrlConfigDiv']").show();			
		}
		else
		{
			$("#dialog-new-repos span[name='showVerCtrlConfig']").val(0);
			$("#dialog-new-repos span[name='showVerCtrlConfig']").text("显示高级选项");
			$("#dialog-new-repos div[name='verCtrlConfigDiv']").hide();						
		}
	}
	
	//According verCtrl value to disale the svnPath or not
	function doSelectVerCtrl()
	{
		var verCtrl = $("#dialog-new-repos select[name='verCtrl']").val();
		var isRemote = $("#dialog-new-repos input[name='isRemote']").is(':checked')? 1: 0;
		console.log("doSelectVerCtrl verCtrl:" + verCtrl + " isRemote:" + isRemote);
		
		//alert(verCtrl);
		if(verCtrl != 0) 			//show verRepos info
		{
			if(isRemote == 0)
			{
				$("#dialog-new-repos div[name='localVerRepos']").hide();
				$("#dialog-new-repos div[name='remoteVerRepos']").hide();
			}
			else
			{
				if(verCtrl == 1)
				{
					$("#dialog-new-repos div[name='localVerRepos']").hide();
				}
				else
				{
					$("#dialog-new-repos div[name='localVerRepos']").show();					
				}
				$("#dialog-new-repos div[name='remoteVerRepos']").show();				
			}
			$("#dialog-new-repos span[name='isRemoteSetting']").show();
			$("#dialog-new-repos div[name='verReposSetting']").show();				
		}
		else	//hide verRepos info
		{
			$("#dialog-new-repos span[name='isRemoteSetting']").hide();
			$("#dialog-new-repos div[name='verReposSetting']").hide();				
		}   
	}
	
	//According verCtrl1 value to disale the svnPath1 or not
	function doSelectVerCtrl1()
	{
		var verCtrl = $("#dialog-new-repos select[name='verCtrl1']").val();
		var isRemote = $("#dialog-new-repos input[name='isRemote1']").is(':checked')? 1: 0;
		console.log("doSelectVerCtrl1 verCtrl:" + verCtrl + " isRemote:" + isRemote);

		if(verCtrl != 0) 			//show verRepos info
		{
			if(isRemote == 0)
			{
				$("#dialog-new-repos div[name='localVerRepos1']").show();
				$("#dialog-new-repos div[name='remoteVerRepos1']").hide();
			}
			else
			{
				if(verCtrl == 1)
				{
					$("#dialog-new-repos div[name='localVerRepos1']").hide();
				}
				else
				{
					$("#dialog-new-repos div[name='localVerRepos1']").show();
				}
				$("#dialog-new-repos div[name='remoteVerRepos1']").show();				
			}
			$("#dialog-new-repos span[name='isRemoteSetting1']").show();
			$("#dialog-new-repos div[name='verReposSetting1']").show();				
		}
		else	//hide verRepos info
		{
			$("#dialog-new-repos span[name='isRemoteSetting1']").hide();
			$("#dialog-new-repos div[name='verReposSetting1']").hide();				
		}     
	}

	function doSelectReposStorageConfigEnable()
	{
		var reposStorageConfigEnable = $("#dialog-new-repos input[name='reposStorageConfigEnable']").is(':checked')? 1: 0;
		console.log("doSelectReposStorageConfigEnable reposStorageConfigEnable:" + reposStorageConfigEnable);
		if(reposStorageConfigEnable == 0)
		{
			$("#dialog-new-repos div[name='reposStorageConfig']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='reposStorageConfig']").show();
		}
	}
	
	/** 仓库路径设置 **/
	function doSelectReposStoragePathEnable()
	{
		var reposStoragePathEnable = $("#dialog-new-repos input[name='reposStoragePathEnable']").is(':checked')? 1: 0;
		console.log("doSelectReposStoragePathEnable reposStoragePathEnable:" + reposStoragePathEnable);
		if(reposStoragePathEnable == 0)
		{
			$("#dialog-new-repos div[name='reposStoragePathConfig']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='reposStoragePathConfig']").show();
		}
	}
	
	/** 文件存储路径设置 **/
	function doSelectReposStorageRealDocPathEnable()
	{
		var reposStorageRealDocPathEnable = $("#dialog-new-repos input[name='reposStorageRealDocPathEnable']").is(':checked')? 1: 0;
		console.log("doSelectReposStorageRealDocPathEnable reposStorageRealDocPathEnable:" + reposStorageRealDocPathEnable);
		if(reposStorageRealDocPathEnable == 0)
		{
			$("#dialog-new-repos div[name='reposStorageRealDocPathConfig']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='reposStorageRealDocPathConfig']").show();
		}
	}
	
	/** 文件加密设置  **/
	function doSetEncryptConfirm()
	{
		var en = $("#dialog-new-repos input[name='isEncryptEnabled']").is(':checked')? 1: 0;
		if(en == 1)
		{
			qiao.bs.confirm({
		        id: 'setEncryptConfirm',
		        msg: '仓库文件将被加密存储，密钥一旦丢失将导致文件无法恢复，是否加密？',
		    },function(){
		    	//确认
		    	$("#dialog-new-repos input[name='isEncryptEnabled']").attr("checked","checked");
		    },function(){
				//取消
		    	$("#dialog-new-repos input[name='isEncryptEnabled']").attr("checked",false);			
		    });
		}
	}
	
	/**** 文件服务器前置设置 ***/
	function doSelectRemoteServerProtocol()
	{
		var protocol = $("#dialog-new-repos select[name='remoteServerProtocol']").val();
		console.log("doSelectRemoteServerProtocol protocol:" + protocol);
		if(protocol == undefined || protocol == "")
		{
			$("#dialog-new-repos div[name='remoteServerConfig']").hide();
			return;
		}
		
		var placehoder = getPlacehoderForRemoteStorageProtocol(protocol);
		$("#dialog-new-repos input[name='remoteServer']").attr('placeholder', placehoder);
		$("#dialog-new-repos div[name='remoteServerConfig']").show();		
	}
	
	function getRemoteServerConfig()
	{   
		var protocol = $("#dialog-new-repos select[name='remoteServerProtocol']").val();
		console.log("getRemoteServerConfig protocol:" + protocol);
		if(protocol == undefined || protocol == "")
		{
			return "";
		}
		
		var prefix = "";
		switch(protocol)
		{
		case "svn":
			prefix = "svn://";
			break;
		case "git":
			prefix = "git://";
			break;
		case "mxsdoc":
			prefix = "mxsdoc://";
			break;
		}
		
	    var remoteServer = $("#dialog-new-repos input[name='remoteServer']").val();	//remoteServer
	    if(remoteServer != undefined && remoteServer != "")
		{
	    	remoteServer = prefix + remoteServer;
		}
	    console.log("getRemoteStorageConfig remoteServer:" + remoteServer);
		return remoteServer;
	}	
	
	/**** 远程存储设置 ***/
	function doSelectRemoteStorageConfigEnable()
	{
		var remoteStorageConfigEnable = $("#dialog-new-repos input[name='remoteStorageConfigEnable']").is(':checked')? 1: 0;
		console.log("doSelectRemoteStorageConfigEnable remoteStorageConfigEnable:" + remoteStorageConfigEnable);
		if(remoteStorageConfigEnable == 0)
		{
			$("#dialog-new-repos div[name='remoteStorageConfigDiv']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='remoteStorageConfigDiv']").show();
		}
		
	}
	
	function doSelectRemoteStorageProtocol()
	{
		var protocol = $("#dialog-new-repos select[name='remoteStorageProtocol']").val();
		console.log("doSelectRemoteStorageProtocol protocol:" + protocol);
		if(protocol == undefined || protocol == "")
		{
			$("#dialog-new-repos div[name='remoteStorageProtocolConfig']").hide();
			return;
		}

		var placehoder = getPlacehoderForRemoteStorageProtocol(protocol);
		$("#dialog-new-repos input[name='remoteStorage']").attr('placeholder', placehoder);
		$("#dialog-new-repos div[name='remoteStorageProtocolConfig']").show();		
	}
	
	function getRemoteStorageConfig()
	{   
		var remoteStorageConfigEnable = $("#dialog-new-repos input[name='remoteStorageConfigEnable']").is(':checked')? 1: 0;
		console.log("getRemoteStorageConfig remoteStorageConfigEnable:" + remoteStorageConfigEnable);
		if(remoteStorageConfigEnable == 0)
		{
			return "";
		}
		
		var protocol = $("#dialog-new-repos select[name='remoteStorageProtocol']").val();
		console.log("getRemoteStorageConfig protocol:" + protocol);
		if(protocol == undefined || protocol == "")
		{
			return "";
		}
		
		var prefix = "";
		switch(protocol)
		{
		case "svn":
			prefix = "svn://";
			break;
		case "git":
			prefix = "git://";
			break;
		case "mxsdoc":
			prefix = "mxsdoc://";
			break;
		}
		
	    var remoteStorage = $("#dialog-new-repos input[name='remoteStorage']").val();	//remoteStorage
		var autoPull = $("#dialog-new-repos input[name='autoPull']").is(':checked')? 1: 0;
		var autoPullForce = $("#dialog-new-repos input[name='autoPullForce']").is(':checked')? 1: 0;
		var autoPush = $("#dialog-new-repos input[name='autoPush']").is(':checked')? 1: 0;
		var autoPushForce = $("#dialog-new-repos input[name='autoPushForce']").is(':checked')? 1: 0;
	    if(remoteStorage != undefined && remoteStorage != "")
		{
	    	remoteStorage += ";autoPull=" + autoPull + ";autoPullForce=" + autoPullForce + ";autoPush=" + autoPush + ";autoPushForce=" + autoPushForce;
			remoteStorage = prefix + remoteStorage;
		}
	    console.log("getRemoteStorageConfig remoteStorage:" + remoteStorage);
		return remoteStorage;
	}	
	
	/********* 自动备份设置 *****************/
	function doSelectAutoBackupConfigEanble()
	{
		var autoBackupEnable = $("#dialog-new-repos input[name='autoBackupEnable']").is(':checked')? 1: 0;
		console.log("doSelectAutoBackupConfigEanble autoBackupEnable:" + autoBackupEnable);
		if(autoBackupEnable == 0)
		{
			$("#dialog-new-repos div[name='autoBackupConfigDiv']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='autoBackupConfigDiv']").show();
		}		
	}
	
	function doSelectLocalBackupEnable()
	{
		var localBackupEnable = $("#dialog-new-repos input[name='localBackupEnable']").is(':checked')? 1: 0;
		console.log("doSelectLocalBackupEnable localBackupEnable:" + localBackupEnable);
		if(localBackupEnable == 0)
		{
			$("#dialog-new-repos div[name='localBackupConfig']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='localBackupConfig']").show();
		}		
	}
	
	function doSelectRemoteBackupEnable()
	{
		var remoteBackupEnable = $("#dialog-new-repos input[name='remoteBackupEnable']").is(':checked')? 1: 0;
		console.log("doSelectRemoteBackupEnable remoteBackupEnable:" + remoteBackupEnable);
		if(remoteBackupEnable == 0)
		{
			$("#dialog-new-repos div[name='remoteBackupConfig']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='remoteBackupConfig']").show();
		}		
	}
	
	function doSelectRemoteBackupStorageProtocol()
	{
		var protocol = $("#dialog-new-repos select[name='remoteBackupStorageProtocol']").val();
		console.log("doSelectRemoteBackupStorageProtocol protocol:" + protocol);
		if(protocol == undefined || protocol == "")
		{
			$("#dialog-new-repos div[name='remoteBackupStorageConfig']").hide();
			return;
		}
		
		var placehoder = getPlacehoderForRemoteStorageProtocol(protocol);
		$("#dialog-new-repos input[name='remoteBackupStorage']").attr('placeholder', placehoder);
		$("#dialog-new-repos div[name='remoteBackupStorageConfig']").show();
	}
	
	/** 异地备份高级选项 **/
	function doSelectRemoteBackupFilterEnable()
	{
		var enable = $("#dialog-new-repos input[name='remoteBackupFilterEnable']").is(':checked')? 1: 0;
		console.log("doSelectRemoteBackupFilterEnable enable:" + enable);
		if(enable == 0)
		{
			$("#dialog-new-repos div[name='remoteBackupFilterConfig']").hide();
		}
		else
		{	
			$("#dialog-new-repos div[name='remoteBackupFilterConfig']").show();
		}
	}
	
	function getTextSearchConfig()
	{   
	    var isTextSearchEnabled = $("#dialog-new-repos input[name='isTextSearchEnabled']").is(':checked')? 1: 0;
		console.log("getTextSearchConfig isTextSearchEnabled:" + isTextSearchEnabled);
		var config = "{enable:" + isTextSearchEnabled + "}";
		return config;
	}

	function getAutoBackupConfig()
	{   
		var autoBackupEnable = $("#dialog-new-repos input[name='autoBackupEnable']").is(':checked')? 1: 0;
		console.log("getAutoBackupConfig autoBackupEnable:" + autoBackupEnable);
		if(autoBackupEnable == 0)
		{
			return "{localBackup:{},remoteBackup:{}}";
		}
		
		var localBackupConfig = getLocalBackupConfig();
		var remoteBackupConfig = getRemoteBackupConfig();
		return "{localBackup:" + localBackupConfig + ",remoteBackup:" + remoteBackupConfig + "}";
	}
		
	function getLocalBackupConfig()
	{
		var localBackupEnable = $("#dialog-new-repos input[name='localBackupEnable']").is(':checked')? 1: 0;
		console.log("getLocalBackupConfig localBackupEnable:" + localBackupEnable);
		if(localBackupEnable == 0)
		{
			return "{}";
		}
		
		var localRootPath = $("#dialog-new-repos input[name='localBackupRootPath']").val();
		if(localRootPath == undefined || localRootPath == "")
		{
			return "{}";
		}

		var backupTime = $("#dialog-new-repos select[name='localBackupTime']").val();;
	    var weekDay1 = $("#dialog-new-repos input[name='localBackupWeekDay1']").is(':checked')? 1: 0;
	    var weekDay2 = $("#dialog-new-repos input[name='localBackupWeekDay2']").is(':checked')? 1: 0;
	    var weekDay3 = $("#dialog-new-repos input[name='localBackupWeekDay3']").is(':checked')? 1: 0;
	    var weekDay4 = $("#dialog-new-repos input[name='localBackupWeekDay4']").is(':checked')? 1: 0;
	    var weekDay5 = $("#dialog-new-repos input[name='localBackupWeekDay5']").is(':checked')? 1: 0;
	    var weekDay6 = $("#dialog-new-repos input[name='localBackupWeekDay6']").is(':checked')? 1: 0;
	    var weekDay7 = $("#dialog-new-repos input[name='localBackupWeekDay7']").is(':checked')? 1: 0;
	    var realTimeBackup = $("#dialog-new-repos input[name='localRealTimeBackupEnable']").is(':checked')? 1: 0;

		var localBackupConfig = 
		"{" +
			"backupTime:" + backupTime + "," +
			"weekDay1:" + weekDay1 +"," + 
			"weekDay2:" + weekDay2 +"," + 
			"weekDay3:" + weekDay3 +"," + 
			"weekDay4:" + weekDay4 +"," + 
			"weekDay5:" + weekDay5 +"," + 
			"weekDay6:" + weekDay6 +"," + 
			"weekDay7:" + weekDay7 +"," + 
			"realTimeBackup:" + realTimeBackup + "," +
			"localRootPath:\"" + localRootPath + "\"" +
		"}";
		return localBackupConfig;
	}
	
	function getRemoteBackupConfig()
	{
		var remoteBackupEnable = $("#dialog-new-repos input[name='remoteBackupEnable']").is(':checked')? 1: 0;
		console.log("getRemoteBackupConfig remoteBackupEnable:" + remoteBackupEnable);
		if(remoteBackupEnable == 0)
		{
			return "{}";
		}
		
		var remoteStorage = getRemoteBackupRemoteStorageConfig();
		if(remoteStorage == "")
		{
			return "{}";
		}
		
		var backupTime = $("#dialog-new-repos select[name='remoteBackupTime']").val();
	    var weekDay1 = $("#dialog-new-repos input[name='remoteBackupWeekDay1']").is(':checked')? 1: 0;
	    var weekDay2 = $("#dialog-new-repos input[name='remoteBackupWeekDay2']").is(':checked')? 1: 0;
	    var weekDay3 = $("#dialog-new-repos input[name='remoteBackupWeekDay3']").is(':checked')? 1: 0;
	    var weekDay4 = $("#dialog-new-repos input[name='remoteBackupWeekDay4']").is(':checked')? 1: 0;
	    var weekDay5 = $("#dialog-new-repos input[name='remoteBackupWeekDay5']").is(':checked')? 1: 0;
	    var weekDay6 = $("#dialog-new-repos input[name='remoteBackupWeekDay6']").is(':checked')? 1: 0;
	    var weekDay7 = $("#dialog-new-repos input[name='remoteBackupWeekDay7']").is(':checked')? 1: 0;
	    var realTimeBackup = $("#dialog-new-repos input[name='remoteRealTimeBackupEnable']").is(':checked')? 1: 0;

	    //高级选项
	    var allowedMaxFile = "";
	    var allowedFileTypeList = "";
	    var notAllowedFileTypeList = "";
	    var notAllowedFileList = "";
		var remoteBackupFilterEnable = $("#dialog-new-repos input[name='remoteBackupFilterEnable']").is(':checked')? 1: 0;
		console.log("getRemoteBackupConfig remoteBackupFilterEnable:" + remoteBackupFilterEnable);
		if(remoteBackupFilterEnable == 1)
		{
		    allowedMaxFile = $("#dialog-new-repos select[name='allowedMaxFile']").val();
		    allowedFileTypeList = $("#dialog-new-repos textarea[name='allowedFileTypeList']").val();
		    notAllowedFileTypeList = $("#dialog-new-repos textarea[name='notAllowedFileTypeList']").val();
		    notAllowedFileList = $("#dialog-new-repos textarea[name='notAllowedFileList']").val();
		}
	    
	    var remoteBackupConfig = 
		"{" +
			"backupTime:" + backupTime + ","  + 
			"weekDay1:" + weekDay1 +"," + 
			"weekDay2:" + weekDay2 +"," + 
			"weekDay3:" + weekDay3 +"," + 
			"weekDay4:" + weekDay4 +"," + 
			"weekDay5:" + weekDay5 +"," + 
			"weekDay6:" + weekDay6 +"," + 
			"weekDay7:" + weekDay7 +"," + 
			"allowedMaxFile:\"" + allowedMaxFile + "\"" +
			"allowedFileTypeList:\"" + allowedFileTypeList + "\"" +
			"notAllowedFileTypeList:\"" + notAllowedFileTypeList + "\"" +
			"notAllowedFileList:\"" + notAllowedFileList + "\"" +
			"realTimeBackup:" + realTimeBackup + "," +
		"}";
		
		return remoteBackupConfig;
	}
	
	function getRemoteBackupRemoteStorageConfig()
	{
		var protocol = $("#dialog-new-repos select[name='remoteBackupStorageProtocol']").val();
		console.log("getRemoteBackupRemoteStorageConfig protocol:" + protocol);
		if(protocol == undefined || protocol == "")
		{
			return "";
		}
		
		var prefix = "";
		switch(protocol)
		{
		case "svn":
			prefix = "svn://";
			break;
		case "git":
			prefix = "git://";
			break;
		case "mxsdoc":
			prefix = "mxsdoc://";
			break;
		}
		
	    var remoteStorage = $("#dialog-new-repos input[name='remoteBackupStorage']").val();	//remoteStorage
	    if(remoteStorage != undefined && remoteStorage != "")
		{
	    	remoteStorage = prefix + remoteStorage;
		}
	    console.log("getRemoteBackupRemoteStorageConfig remoteStorage:" + remoteStorage);
		return remoteStorage;
	}
	
	function doRemoteSeverTest()
	{
		console.log("doRemoteSeverTest()");

		var config = getRemoteServerConfig();
		console.log("doRemoteSeverTest() config:", config);
		
		remoteStorageServerTest(config, "RemoteServer");
	}
	
	function doRemoteStorageTest()
	{
		console.log("doRemoteStorageTest()");

		var config = getRemoteStorageConfig();
		console.log("doRemoteStorageTest() config:", config);
		
		remoteStorageServerTest(config, "RemoteStorage");
	}
	
	function doRemoteBackupStorageTest()
	{
		console.log("doRemoteBackupStorageTest()");

		var config = getRemoteBackupRemoteStorageConfig();
		console.log("doRemoteBackupStorageTest() config:", config);
		
		remoteStorageServerTest(config, "RemoteBackupStorage");
	}
	
	function doVerReposTest()
	{
		console.log("doVerReposTest()");
		
		var verCtrl = $("#dialog-new-repos select[name='verCtrl']").val();
	    var url = $("#dialog-new-repos input[name='svnPath']").val();
	    var user = $("#dialog-new-repos input[name='svnUser']").val();
	    var pwd = $("#dialog-new-repos input[name='svnPwd']").val();
		console.log("doVerReposTest() verCtrl:" + verCtrl + " url:" + url + " user:" +user + " pwd:" + pwd);
		
		var prefix = "";
		switch(verCtrl)
		{
		case "1":
			prefix = "svn://";
			break;
		case "2":
			prefix = "git://";
			break;
		default:
			break;
		}
		
		var config = prefix + url + ";userName=" + user + ";pwd=" + pwd;
		console.log("doVerReposTest() config:" + config);

		remoteStorageServerTest(config, "VerRepos");
	}
	
	function remoteStorageServerTest(config, type)
	{
		console.log("remoteStorageServerTest() config:" + config);
	    $.ajax({
	        url : "/DocSystem/Repos/remoteStorageTest.do",
	        type : "post",
	        dataType : "json",
	        data : {
	            config : config,
	        	type: type,
	        },
	        success : function (ret) {
	            if( "ok" == ret.status )
	            {
	            	showErrorMessage("<font color='green'><strong>测试成功</strong></font><br/><br/>" + ret.msgInfo);
	            }
	            else
	            {
	            	showErrorMessage("<font color='red'><strong>测试失败</strong></font><br/><br/>" + ret.msgInfo);
	            }
	        },
	        error : function () {
	           	showErrorMessage('测试失败:服务器异常！');
	        }
		});
	}
</script>

