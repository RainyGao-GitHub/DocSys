<div>
        <div class="manual-left width:20%" style="display:none">
            <div class="manual-article">
               <div class="article-body editor-content"  id="doc" style="min-height: 650px">
               		<div class="panel-body eventset-list" >	
	               		<li class="eventset-tit" style="margin-top: 0px;">
							<i class="cell username w15">用户名</i>
							<i class="cell operation w10">操作</i>						
						</li>
					</div>
               		<div class="panel-body eventset-list" id="reposAuthedUsers">
			 			<!-- 仓库权限列表区域-->
					</div>
			 </div>
        	</div>
        </div>
        <div class="manual-right width:80%" >
            <div class="manual-article">
               <div class="article-body editor-content"  id="doc" style="min-height: 650px">
               		<div class="panel-body eventset-list" >	
	               		<li class="eventset-tit" style="margin-top: 0px;">
							<i class="cell username w15">用户名</i>
							<i class="cell operation w10">操作</i>						
						</li>
					</div>
               		<div class="panel-body eventset-list" id="reposNotAuthedUsers">
			 			<!-- 仓库权限列表区域-->
					</div>
			 </div>
			</div>
		</div>
</div>

<script type="text/javascript">
	function addReposUserPageInit()
	{
		//alert("addReposUserPageInit");
		//showReposAuthedUserList();
		showReposNotAuthedUserList();		
	}

        
    //页面初始化代码    
    $(function(){
		addReposUserPageInit();
	});

function showReposAuthedUserList(){
   	console.log("showReposAuthedUserList()");
   	var vid = getQueryString("vid");

    $.ajax({
            url : "/DocSystem/Repos/getReposAuthedUsers.do",
            type : "post",
            dataType : "json",
            data : {
                reposId : vid,
            },
            success : function (ret) {
                if( "ok" == ret.status ){
                    showUserList(ret.data);
                }
                else
                {
                	alert("Error:" + ret.msgInfo);
                }
            },
            error : function () {
               alert('服务器异常：获取仓库用户列表失败！');
            }
    });


	//根据获取到的目录权限用户列表数据，绘制列表
	function showUserList(data){
		console.log(data);
		var c = $("#reposAuthedUsers").children();
		$(c).remove();
		if(data.length==0){
			$("#reposAuthedUsers").append("<p>暂无数据</p>");
		}
		
		var vid = getQueryString("vid");
		
		for(var i=0;i<data.length;i++){
			var d = data[i];
			var se = "<li value="+ i +">"
				+"	<i class='cell username w15'>"
				+"		<span class='name'>"
				+"			<a id='UserName"+i+"' href='javascript:void(0)'>"+d.name+"</a>"
				+"		</span>"
				+"	</i>"
				+"	<i class='cell operation w10'>"
				+"		<a href='javascript:void(0)' onclick='deleteReposUser("+d.id+");' class='mybtn-primary'>删除</a>"
				+"	</i>"
				+"</li>";
			
			$("#reposAuthedUsers").append(se);
		}
	}
}

function showReposNotAuthedUserList(){
   	console.log("showReposNotAuthedUserList()");
   	var vid = getQueryString("vid");

    $.ajax({
            url : "/DocSystem/Repos/getReposNotAuthedUsers.do",
            type : "post",
            dataType : "json",
            data : {
                reposId : vid,
            },
            success : function (ret) {
                if( "ok" == ret.status ){
                    showUserList(ret.data);
                }
                else
                {
                	alert("Error:" + ret.msgInfo);
                }
            },
            error : function () {
               alert('服务器异常：获取仓库用户列表失败！');
            }
    });


	//根据获取到的目录权限用户列表数据，绘制列表
	function showUserList(data){
		console.log(data);
		var c = $("#reposNotAuthedUsers").children();
		$(c).remove();
		if(data.length==0){
			$("#reposNotAuthedUsers").append("<p>暂无数据</p>");
		}
		
		var vid = getQueryString("vid");
		
		for(var i=0;i<data.length;i++){
			var d = data[i];
			var opBtn = "		<a href='javascript:void(0)' onclick='addReposUser("+d.id+");' class='mybtn-primary'>添加</a>";
			if(d.reposId > 0) //已是仓库用户的，操作按键显示为，已添加
			{
				opBtn = "		<a href='javascript:void(0)' class='mybtn' disabled='disabled'>已添加</a>";
			}
												
			var se = "<li value="+ i +">"
				+"	<i class='cell username w15'>"
				+"		<span class='name'>"
				+"			<a id='UserName"+i+"' href='javascript:void(0)'>"+d.name+"</a>"
				+"		</span>"
				+"	</i>"
				+"	<i class='cell operation w10'>"
				+		opBtn
				+"	</i>"
				+"</li>";
			
			$("#reposNotAuthedUsers").append(se);
		}
	}
}

function addReposUser(userId)
{
   	console.log("showReposNotAuthedUserList()");
   	var vid = getQueryString("vid");

    $.ajax({
            url : "/DocSystem/Repos/addUserReposAuth.do",
            type : "post",
            dataType : "json",
            data : {
            	userId: userId,
                reposId : vid,
            },
            success : function (ret) {
                if( "ok" == ret.status ){
                    //showReposAuthedUserList();
                    showDocAuthedUserList();
                    showReposNotAuthedUserList();
                }
                else
                {
                	showErrorMessage("Error:" + ret.msgInfo);
                }
            },
            error : function () {
               showErrorMessage('服务器异常：获取仓库用户列表失败！');
            }
    });
}
</script>
