
<script type="text/javascript">
	var shareId = null;
	function DocSharePageInit(docShare, docName, url)
	{
		shareId = docShare.shareId;
		$("#shareLink").val(url);
		
		//设置分享密码
		if(!docShare.sharePwd)
		{
			$("#sharePwd").val("");
		}
		else
		{
			$("#sharePwd").val(docShare.sharePwd);			
		}
		
		//转换有效时间
		if(!docShare.validHours)
		{
			$("#shareHours").get(0).selectedIndex=0;
		}
		else 
		{
			if(docShare.validHours > 10000) //大于10000小时
			{
				$("#shareHours").get(0).selectedIndex=0;
			}
			else if(docShare.validHours > 48) //大于48小时
			{
				$("#shareHours").get(0).selectedIndex=1;
			}
			else //其他清空
			{
				$("#shareHours").get(0).selectedIndex=2;
			}			
		}
		
		//分享权限转换
		var shareAuth = JSON.parse(docShare.shareAuth);
		if(shareAuth.downloadEn && shareAuth.downloadEn == 1)
		{
			//允许下载
			$("#downloadEn").attr('checked', 'true');
		}
		if(shareAuth.addEn && shareAuth.addEn == 1)
		{
			//允许上传
			$("#addEn").attr('checked', 'true');
		}
		if(shareAuth.editEn && shareAuth.editEn == 1)
		{
			//允许编辑
			$("#editEn").attr('checked', 'true');
		}
		if(shareAuth.deleteEn && shareAuth.deleteEn == 1)
		{
			//允许删除
			$("#deleteEn").attr('checked', 'true');
		}
	}
	
	function showDocShare(text){
		$(".docShareModal").fadeIn("slow");
	}
	
	function closeDocShare(){
		$(".docShareModal").fadeOut("slow");
	}
	
	function updateDocShare(){
		console.log("updateDocShare() shareId:" + shareId);
		
		var sharePwd = $("#sharePwd").val();
		var shareHours = $("#shareHours").val();		
		var downloadEn = $("#downloadEn").prop("checked")?1:0;;
		var addEn = $("#addEn").prop("checked")?1:0;;
		var deleteEn = $("#deleteEn").prop("checked")?1:0;;
		var editEn = $("#editEn").prop("checked")?1:0;;
		
    	$.ajax({
             url : "/DocSystem/Doc/updateDocShare.do",
             type : "post",
             dataType : "json",
             data : {
            	shareId : shareId,
            	isAdmin : 0,
            	access : 1,
            	downloadEn : downloadEn,
            	addEn : addEn,
            	deleteEn : deleteEn,
            	editEn : editEn,
            	heritable : 1,     
            	sharePwd : sharePwd,
            	shareHours : shareHours,
             },
             success : function (ret) {
             	console.log("updateDocShare ret:", ret);
             	if( "ok" == ret.status){
            		bootstrapQ.msg({
    					msg : '保存成功！',
    					type : 'success',
    					time : 1000,
    				});
            		closeDocShare();
            		return;
	            }
                else
                {
            		bootstrapQ.msg({
    					msg : '保存失败:' + ret.MsgInfo,
    					type : 'danger',
    					time : 1000,
    				});
            		return false;
                }
            },
            error : function () {
        		bootstrapQ.msg({
					msg : '保存失败:服务器异常',
					type : 'danger',
					time : 1000,
				});
	            return false;
            }
        });
		return true;
    }
	
	//登录按键处理函数
	function deleteDocShare(){
		console.log("deleteDocShare() shareId:" + shareId);
		
    	$.ajax({
             url : "/DocSystem/Doc/deleteDocShare.do",
             type : "post",
             dataType : "json",
             data : {
            	shareId : shareId,
             },
             success : function (ret) {
            	console.log("deleteDocShare ret:", ret);
             	if( "ok" == ret.status){
            		bootstrapQ.msg({
    					msg : '取消成功！',
    					type : 'success',
    					time : 1000,
    				});
            		closeDocShare();
            		return;
	            }
                else
                {
            		bootstrapQ.msg({
    					msg : '取消失败:' + ret.MsgInfo,
    					type : 'danger',
    					time : 1000,
    				});
            		return false;
                }
            },
            error : function () {
        		bootstrapQ.msg({
					msg : '取消失败:服务器异常',
					type : 'danger',
					time : 1000,
				});
	            return false;
            }
        });
		return true;
    }
</script>

<div class="form-horizontal">
    <div class="form-group">
        <label class="col-sm-2 control-label">分享链接</label>
        <div class="col-sm-10">
            <input type="text" id="shareLink" name="shareLink" class="form-control"  maxlength="400"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">提取密码</label>
        <div class="col-sm-10">
            <input type="text" id="sharePwd" name="sharePwd" class="form-control"  maxlength="40" placeholder="提取密码" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">有效时间</label>
        <div class="col-sm-10">
            <select class="form-control" id="shareHours" name="shareHours" style="width: 100%">   
            	<option value="1000000" >永久有效</option>
            	<option value="168" selected="selected">7天</option>
            	<option value="24">1天</option>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">权限设置</label>
        <div class="col-sm-10" style="margin-top:0.5em;">
	        <input id="downloadEn" name="downloadEn" type="checkbox" >
				<span class="p5">允许下载</span>
			</input>
			<input id="addEn" name="addEn" type="checkbox" style="margin-left:1em;">
				<span class="p5">允许上传</span>
			</input>
			<input id="editEn" name="editEn" type="checkbox" style="margin-left:1em;">
				<span class="p5">允许修改</span>
			</input>
			<input id="deleteEn" name="deleteEn" type="checkbox" style="margin-left:1em;">
				<span class="p5">允许删除</span>
			</input>
		</div>
    </div>    
	<div class="form-group">
	    <div class="col-sm-12 text-center">
	        <button  id="submit" type="button" class="btn btnPrimary" onclick="deleteDocShare();" style="width: 100px;height: 42px;">取消分享</button>
	        <button  id="submit" type="button" class="btn btnPrimary" onclick="updateDocShare();" style="width: 100px;height: 42px;">保存</button>
		</div>
	</div>
</div>
